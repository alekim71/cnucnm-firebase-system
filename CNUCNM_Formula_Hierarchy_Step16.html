<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNUCNM ìˆ˜ì‹ ê³„ì¸µ êµ¬ì¡° - 16ë‹¨ê³„: ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ëª¨ë¸ ì™„ì „ êµ¬í˜„</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 2000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .progress-info {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-weight: bold;
            color: #667eea;
        }

        .formula-stats {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .classification-system {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-left: 6px solid #ffa726;
        }

        .classification-system h3 {
            color: #ffa726;
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }

        .classification-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .classification-category {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ffa726;
        }

        .classification-category h4 {
            color: #ffa726;
            margin-bottom: 10px;
        }

        .category-item {
            background: white;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border: 1px solid #e9ecef;
            font-size: 14px;
        }

        .mineral-rumen-focus {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border-left: 6px solid #9c27b0;
        }

        .mineral-rumen-focus h3 {
            color: #9c27b0;
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }

        .mineral-rumen-chain {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #9c27b0;
        }

        .mineral-rumen-chain h4 {
            color: #9c27b0;
            margin-bottom: 10px;
        }

        .chain-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .hierarchy-container {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .hierarchy-title {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .formula-tree {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .formula-level {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-bottom: 10px;
        }

        .top-level {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-bottom: 10px;
        }

        .formula-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }

        .formula-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 120px;
            text-align: center;
            margin: 5px;
        }

        .formula-button:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .formula-button.selected {
            background: #28a745;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .formula-button.expanded {
            background: #ffc107;
            color: #333;
        }

        .formula-button.has-children {
            background: #17a2b8;
        }

        .formula-button.leaf {
            background: #6c757d;
        }

        .formula-button.mp-related {
            background: #ff6b6b;
        }

        .formula-button.mp-related:hover {
            background: #ff5252;
        }

        .formula-button.me-related {
            background: #4ecdc4;
        }

        .formula-button.me-related:hover {
            background: #45b7aa;
        }

        .formula-button.dmi-related {
            background: #fd79a8;
        }

        .formula-button.dmi-related:hover {
            background: #f368a0;
        }

        .formula-button.carb-rumen-related {
            background: #4caf50;
        }

        .formula-button.carb-rumen-related:hover {
            background: #45a049;
        }

        .formula-button.protein-rumen-related {
            background: #2196f3;
        }

        .formula-button.protein-rumen-related:hover {
            background: #1976d2;
        }

        .formula-button.fat-rumen-related {
            background: #ff9800;
        }

        .formula-button.fat-rumen-related:hover {
            background: #f57c00;
        }

        .formula-button.mineral-rumen-related {
            background: #9c27b0;
        }

        .formula-button.mineral-rumen-related:hover {
            background: #7b1fa2;
        }

        .formula-details {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .formula-details h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .selected-formula {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #28a745;
            margin-bottom: 20px;
        }

        .formula-name {
            font-weight: bold;
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .formula-expression {
            color: #666;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #e9ecef;
            margin-bottom: 10px;
        }

        .formula-description {
            color: #888;
            font-size: 14px;
        }

        .controls {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .control-group button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .control-group button:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .network-container {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .network-title {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .network-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .network-controls button {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .network-controls button:hover {
            background: #138496;
            transform: translateY(-1px);
        }

        .network-controls button.active {
            background: #28a745;
        }

        #network-diagram {
            width: 100%;
            height: 600px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            z-index: 2000;
            text-align: center;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .node {
            cursor: pointer;
        }

        .node:hover {
            stroke: #667eea;
            stroke-width: 3px;
        }

        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            stroke-width: 1px;
        }

        .node-label {
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¬ CNUCNM ìˆ˜ì‹ ê³„ì¸µ êµ¬ì¡° - 16ë‹¨ê³„</h1>
            <p>ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ëª¨ë¸ ì™„ì „ êµ¬í˜„: ì˜ì–‘ì†Œë³„+ì¥ì†Œë³„ ì²´ê³„ì  ì ‘ê·¼ìœ¼ë¡œ 27,061ê°œ ìˆ˜ì‹ì„ ì²´ê³„ì ìœ¼ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤!</p>
        </div>

        <div class="progress-info">
            <h3>ğŸ“Š ì‘ì—… ì§„í–‰ ìƒí™©</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 16%"></div>
            </div>
            <div class="progress-text" id="progress-text">16/100 ë‹¨ê³„ ì™„ë£Œ (16%)</div>
        </div>

        <div class="formula-stats">
            <h3>ğŸ“ˆ ì—‘ì…€ ìˆ˜ì‹ êµ¬í˜„ í˜„í™©</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-excel-formulas">27,061</div>
                    <div class="stat-label">ì—‘ì…€ íŒŒì¼ ì´ ìˆ˜ì‹ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="implemented-formulas">0</div>
                    <div class="stat-label">í˜„ì¬ êµ¬í˜„ëœ ìˆ˜ì‹ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="implementation-rate">0%</div>
                    <div class="stat-label">êµ¬í˜„ ì™„ë£Œìœ¨</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="remaining-formulas">27,061</div>
                    <div class="stat-label">ë‚¨ì€ ìˆ˜ì‹ ìˆ˜</div>
                </div>
            </div>
        </div>

        <div class="classification-system">
            <h3>ğŸ¯ ì²´ê³„ì  ë¶„ë¥˜ ì‹œìŠ¤í…œ</h3>
            <div class="classification-grid">
                <div class="classification-category">
                    <h4>ğŸŒ¾ ì˜ì–‘ì†Œë³„ ë¶„ë¥˜</h4>
                    <div class="category-item">íƒ„ìˆ˜í™”ë¬¼ (Carbohydrates) âœ…</div>
                    <div class="category-item">ë‹¨ë°±ì§ˆ (Protein) âœ…</div>
                    <div class="category-item">ì§€ë°© (Fat) âœ…</div>
                    <div class="category-item">ë¯¸ë„¤ë„ (Minerals) ğŸ”„</div>
                    <div class="category-item">ë¹„íƒ€ë¯¼ (Vitamins)</div>
                </div>
                <div class="classification-category">
                    <h4>ğŸ¥ ì¥ì†Œë³„ ë¶„ë¥˜</h4>
                    <div class="category-item">ë°˜ì¶”ìœ„ (Rumen) ğŸ”„</div>
                    <div class="category-item">ì†Œì¥ (Small Intestine)</div>
                    <div class="category-item">ëŒ€ì¥ (Large Intestine)</div>
                    <div class="category-item">ê°„ (Liver)</div>
                    <div class="category-item">ì „ì‹  (Systemic)</div>
                </div>
            </div>
        </div>

        <div class="mineral-rumen-focus">
            <h3>ğŸ¯ ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ëª¨ë¸ ì™„ì „ êµ¬í˜„ ê³„íš</h3>
            <div class="mineral-rumen-chain">
                <h4>ë¯¸ë„¤ë„ ë°˜ì¶”ìœ„ ì²˜ë¦¬ ì²´ì¸ ì™„ì„± ê³„íš:</h4>
                <div class="chain-item">Level 0: Mineral_Rumen_Processing = Total_Minerals Ã— Rumen_Absorption_Rate</div>
                <div class="chain-item">Level 1: Total_Minerals = Macro_Minerals + Micro_Minerals</div>
                <div class="chain-item">Level 1: Rumen_Absorption_Rate = f(pH, Competition, Binding_factors)</div>
                <div class="chain-item">Level 2: Macro_Minerals = Ca + P + Mg + K + Na + Cl + S</div>
                <div class="chain-item">Level 2: Micro_Minerals = Fe + Zn + Cu + Mn + Se + Co + I</div>
                <div class="chain-item">Level 2: Absorption_Rate = Base_rate Ã— pH_factor Ã— Competition_factor Ã— Binding_factor</div>
                <div class="chain-item">Level 3: Ca = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: P = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Mg = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: K = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Na = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Cl = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: S = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Fe = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Zn = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Cu = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Mn = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Se = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Co = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: I = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Rumen_pH = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Competition_factor = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
                <div class="chain-item">Level 3: Binding_factor = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’</div>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <button onclick="loadNextStep()">ë‹¤ìŒ ë‹¨ê³„ ë¡œë“œ</button>
                <button onclick="resetHierarchy()">ê³„ì¸µ ì´ˆê¸°í™”</button>
                <button onclick="exportCurrentData()">í˜„ì¬ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                <button onclick="generateNetworkDiagram()">ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì•„ê·¸ë¨ ìƒì„±</button>
                <button onclick="focusOnMP()">MPì— ì§‘ì¤‘</button>
                <button onclick="focusOnME()">MEì— ì§‘ì¤‘</button>
                <button onclick="focusOnDMI()">DMIì— ì§‘ì¤‘</button>
                <button onclick="focusOnCarbRumen()">íƒ„ìˆ˜í™”ë¬¼-ë°˜ì¶”ìœ„ì— ì§‘ì¤‘</button>
                <button onclick="focusOnProteinRumen()">ë‹¨ë°±ì§ˆ-ë°˜ì¶”ìœ„ì— ì§‘ì¤‘</button>
                <button onclick="focusOnFatRumen()">ì§€ë°©-ë°˜ì¶”ìœ„ì— ì§‘ì¤‘</button>
                <button onclick="focusOnMineralRumen()">ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ì— ì§‘ì¤‘</button>
            </div>
        </div>

        <div class="hierarchy-container">
            <div class="hierarchy-title">ğŸ“ ìˆ˜ì‹ ê³„ì¸µ êµ¬ì¡° (ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ëª¨ë¸ ì™„ì „ êµ¬í˜„)</div>
            <div class="formula-tree" id="formula-tree">
                <!-- ê³„ì¸µ êµ¬ì¡°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <div class="formula-details">
            <h3>ğŸ“‹ ì„ íƒëœ ìˆ˜ì‹ ìƒì„¸ ì •ë³´</h3>
            <div id="selected-formula-details">
                <div class="selected-formula">
                    <div class="formula-name">ìˆ˜ì‹ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
                    <div class="formula-expression">ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ëª¨ë¸ì˜ ì „ì²´ ì˜ì¡´ì„± ì²´ì¸ì„ ì™„ì „íˆ êµ¬í˜„í•˜ì—¬ ì²´ê³„ì ì¸ ì ‘ê·¼ì˜ ë„¤ ë²ˆì§¸ ì™„ì„±ëœ ìˆ˜ì‹ì„ ë§Œë“¤ì–´ë´…ë‹ˆë‹¤.</div>
                    <div class="formula-description">Mineral_Rumen_Processing â†’ Total_Minerals â†’ Macro_Minerals, Micro_Minerals â†’ Ca, P, Mg, K, Na, Cl, S, Fe, Zn, Cu, Mn, Se, Co, I ë“±ì˜ ì™„ì „í•œ êµ¬í˜„ì„ í™•ì¸í•´ë³´ì„¸ìš”!</div>
                </div>
            </div>
        </div>

        <div class="network-container">
            <div class="network-title">ğŸŒ ìˆ˜ì‹ ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì•„ê·¸ë¨</div>
            <div class="network-controls">
                <button onclick="showAllNodes()" class="active">ì „ì²´ ë…¸ë“œ</button>
                <button onclick="showSelectedPath()">ì„ íƒ ê²½ë¡œ</button>
                <button onclick="showTopLevel()">ìµœìƒìœ„ ìˆ˜ì‹</button>
                <button onclick="showMPChain()">MP ì²´ì¸</button>
                <button onclick="showMEChain()">ME ì²´ì¸</button>
                <button onclick="showDMIChain()">DMI ì²´ì¸</button>
                <button onclick="showCarbRumenChain()">íƒ„ìˆ˜í™”ë¬¼-ë°˜ì¶”ìœ„ ì²´ì¸</button>
                <button onclick="showProteinRumenChain()">ë‹¨ë°±ì§ˆ-ë°˜ì¶”ìœ„ ì²´ì¸</button>
                <button onclick="showFatRumenChain()">ì§€ë°©-ë°˜ì¶”ìœ„ ì²´ì¸</button>
                <button onclick="showMineralRumenChain()">ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ì²´ì¸</button>
                <button onclick="zoomIn()">í™•ëŒ€</button>
                <button onclick="zoomOut()">ì¶•ì†Œ</button>
                <button onclick="resetZoom()">ì´ˆê¸°í™”</button>
            </div>
            <div id="network-diagram">
                <!-- ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì•„ê·¸ë¨ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
        <h3>ë°ì´í„° ë¡œë”© ì¤‘...</h3>
        <p id="loading-text">ìˆ˜ì‹ ê³„ì¸µ êµ¬ì¡°ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentStep = 16;
        const totalSteps = 100;
        const totalExcelFormulas = 27061;
        let selectedFormula = null;
        let currentPath = [];
        let networkData = null;
        let simulation = null;

        // 16ë‹¨ê³„: ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ëª¨ë¸ ì™„ì „ êµ¬í˜„ ë°ì´í„°ë² ì´ìŠ¤ (MP + ME + DMI + íƒ„ìˆ˜í™”ë¬¼-ë°˜ì¶”ìœ„ + ë‹¨ë°±ì§ˆ-ë°˜ì¶”ìœ„ + ì§€ë°©-ë°˜ì¶”ìœ„ + ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ì™„ì „ êµ¬í˜„)
        const formulaDatabase = {
            // Level 0: MP (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "MP": {
                name: "MP",
                fullName: "MP (Metabolizable Protein)",
                expression: "MP = MPfeed + MPbact",
                description: "ëŒ€ì‚¬ì„± ë‹¨ë°±ì§ˆ = ì‚¬ë£Œ ë‹¨ë°±ì§ˆ + ë¯¸ìƒë¬¼ ë‹¨ë°±ì§ˆ",
                level: 0,
                dependencies: ["MPfeed", "MPbact"],
                category: "protein",
                hasChildren: true
            },

            // Level 0: ME (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "ME": {
                name: "ME",
                fullName: "ME (Metabolizable Energy)",
                expression: "ME = GE - FE - UE - CH4E",
                description: "ëŒ€ì‚¬ì„± ì—ë„ˆì§€ = ì´ì—ë„ˆì§€ - ë¶„ì—ë„ˆì§€ - ìš”ì—ë„ˆì§€ - ë©”íƒ„ì—ë„ˆì§€",
                level: 0,
                dependencies: ["GE", "FE", "UE", "CH4E"],
                category: "energy",
                hasChildren: true
            },

            // Level 0: DMI (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "DMI": {
                name: "DMI",
                fullName: "DMI (Dry Matter Intake)",
                expression: "DMI = ê¸°ë³¸ ì„­ì·¨ëŸ‰ Ã— ì¡°ì • ê³„ìˆ˜ë“¤",
                description: "ê±´ë¬¼ ì„­ì·¨ëŸ‰ = ê¸°ë³¸ ì„­ì·¨ëŸ‰ Ã— ì—ë„ˆì§€ ì¡°ì • Ã— ë‹¨ë°±ì§ˆ ì¡°ì • Ã— ì„¬ìœ ì§ˆ ì¡°ì •",
                level: 0,
                dependencies: ["ê¸°ë³¸ ì„­ì·¨ëŸ‰", "ì¡°ì • ê³„ìˆ˜ë“¤"],
                category: "intake",
                hasChildren: true
            },

            // Level 0: íƒ„ìˆ˜í™”ë¬¼-ë°˜ì¶”ìœ„ (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "Carb_Rumen_Processing": {
                name: "Carb_Rumen_Processing",
                fullName: "Carb_Rumen_Processing (íƒ„ìˆ˜í™”ë¬¼ ë°˜ì¶”ìœ„ ì²˜ë¦¬)",
                expression: "Carb_Rumen_Processing = Total_Carbs Ã— Rumen_Fermentation_Rate",
                description: "íƒ„ìˆ˜í™”ë¬¼ ë°˜ì¶”ìœ„ ì²˜ë¦¬ëŸ‰ = ì´ íƒ„ìˆ˜í™”ë¬¼ Ã— ë°˜ì¶”ìœ„ ë°œíš¨ìœ¨",
                level: 0,
                dependencies: ["Total_Carbs", "Rumen_Fermentation_Rate"],
                category: "carbohydrate_rumen",
                hasChildren: true
            },

            // Level 0: ë‹¨ë°±ì§ˆ-ë°˜ì¶”ìœ„ (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "Protein_Rumen_Processing": {
                name: "Protein_Rumen_Processing",
                fullName: "Protein_Rumen_Processing (ë‹¨ë°±ì§ˆ ë°˜ì¶”ìœ„ ì²˜ë¦¬)",
                expression: "Protein_Rumen_Processing = Total_Protein Ã— Rumen_Degradation_Rate",
                description: "ë‹¨ë°±ì§ˆ ë°˜ì¶”ìœ„ ì²˜ë¦¬ëŸ‰ = ì´ ë‹¨ë°±ì§ˆ Ã— ë°˜ì¶”ìœ„ ë¶„í•´ìœ¨",
                level: 0,
                dependencies: ["Total_Protein", "Rumen_Degradation_Rate"],
                category: "protein_rumen",
                hasChildren: true
            },

            // Level 0: ì§€ë°©-ë°˜ì¶”ìœ„ (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "Fat_Rumen_Processing": {
                name: "Fat_Rumen_Processing",
                fullName: "Fat_Rumen_Processing (ì§€ë°© ë°˜ì¶”ìœ„ ì²˜ë¦¬)",
                expression: "Fat_Rumen_Processing = Total_Fat Ã— Rumen_Hydrolysis_Rate",
                description: "ì§€ë°© ë°˜ì¶”ìœ„ ì²˜ë¦¬ëŸ‰ = ì´ ì§€ë°© Ã— ë°˜ì¶”ìœ„ ê°€ìˆ˜ë¶„í•´ìœ¨",
                level: 0,
                dependencies: ["Total_Fat", "Rumen_Hydrolysis_Rate"],
                category: "fat_rumen",
                hasChildren: true
            },

            // Level 0: ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ (ìƒˆë¡œ ì™„ì „ êµ¬í˜„)
            "Mineral_Rumen_Processing": {
                name: "Mineral_Rumen_Processing",
                fullName: "Mineral_Rumen_Processing (ë¯¸ë„¤ë„ ë°˜ì¶”ìœ„ ì²˜ë¦¬)",
                expression: "Mineral_Rumen_Processing = Total_Minerals Ã— Rumen_Absorption_Rate",
                description: "ë¯¸ë„¤ë„ ë°˜ì¶”ìœ„ ì²˜ë¦¬ëŸ‰ = ì´ ë¯¸ë„¤ë„ Ã— ë°˜ì¶”ìœ„ í¡ìˆ˜ìœ¨",
                level: 0,
                dependencies: ["Total_Minerals", "Rumen_Absorption_Rate"],
                category: "mineral_rumen",
                hasChildren: true
            },

            // Level 1: ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ í•˜ìœ„ ìˆ˜ì‹ë“¤ (ìƒˆë¡œ ì™„ì „ êµ¬í˜„)
            "Total_Minerals": {
                name: "Total_Minerals",
                fullName: "Total_Minerals (ì´ ë¯¸ë„¤ë„)",
                expression: "Total_Minerals = Macro_Minerals + Micro_Minerals",
                description: "ì´ ë¯¸ë„¤ë„ = ë‹¤ëŸ‰ ë¯¸ë„¤ë„ + ë¯¸ëŸ‰ ë¯¸ë„¤ë„",
                level: 1,
                dependencies: ["Macro_Minerals", "Micro_Minerals"],
                category: "mineral",
                hasChildren: true,
                parent: "Mineral_Rumen_Processing"
            },
            "Rumen_Absorption_Rate": {
                name: "Rumen_Absorption_Rate",
                fullName: "Rumen_Absorption_Rate (ë°˜ì¶”ìœ„ í¡ìˆ˜ìœ¨)",
                expression: "Rumen_Absorption_Rate = Base_rate Ã— pH_factor Ã— Competition_factor Ã— Binding_factor",
                description: "ë°˜ì¶”ìœ„ í¡ìˆ˜ìœ¨ = ê¸°ë³¸ í¡ìˆ˜ìœ¨ Ã— pH ê³„ìˆ˜ Ã— ê²½ìŸ ê³„ìˆ˜ Ã— ê²°í•© ê³„ìˆ˜",
                level: 1,
                dependencies: ["Base_rate", "pH_factor", "Competition_factor", "Binding_factor"],
                category: "absorption",
                hasChildren: true,
                parent: "Mineral_Rumen_Processing"
            },

            // Level 2: Total_Minerals í•˜ìœ„ ìˆ˜ì‹ë“¤ (ìƒˆë¡œ ì™„ì „ êµ¬í˜„)
            "Macro_Minerals": {
                name: "Macro_Minerals",
                fullName: "Macro_Minerals (ë‹¤ëŸ‰ ë¯¸ë„¤ë„)",
                expression: "Macro_Minerals = Ca + P + Mg + K + Na + Cl + S",
                description: "ë‹¤ëŸ‰ ë¯¸ë„¤ë„ = ì¹¼ìŠ˜ + ì¸ + ë§ˆê·¸ë„¤ìŠ˜ + ì¹¼ë¥¨ + ë‚˜íŠ¸ë¥¨ + ì—¼ì†Œ + í™©",
                level: 2,
                dependencies: ["Ca", "P", "Mg", "K", "Na", "Cl", "S"],
                category: "mineral",
                hasChildren: true,
                parent: "Total_Minerals"
            },
            "Micro_Minerals": {
                name: "Micro_Minerals",
                fullName: "Micro_Minerals (ë¯¸ëŸ‰ ë¯¸ë„¤ë„)",
                expression: "Micro_Minerals = Fe + Zn + Cu + Mn + Se + Co + I",
                description: "ë¯¸ëŸ‰ ë¯¸ë„¤ë„ = ì²  + ì•„ì—° + êµ¬ë¦¬ + ë§ê°„ + ì…€ë ˆëŠ„ + ì½”ë°œíŠ¸ + ìš”ì˜¤ë“œ",
                level: 2,
                dependencies: ["Fe", "Zn", "Cu", "Mn", "Se", "Co", "I"],
                category: "mineral",
                hasChildren: true,
                parent: "Total_Minerals"
            },

            // Level 2: Rumen_Absorption_Rate í•˜ìœ„ ìˆ˜ì‹ë“¤ (ìƒˆë¡œ ì™„ì „ êµ¬í˜„)
            "Base_rate": {
                name: "Base_rate",
                fullName: "Base_rate (ê¸°ë³¸ í¡ìˆ˜ìœ¨)",
                expression: "Base_rate = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ê¸°ë³¸ í¡ìˆ˜ìœ¨",
                level: 2,
                dependencies: [],
                category: "coefficient",
                hasChildren: false,
                parent: "Rumen_Absorption_Rate"
            },
            "pH_factor": {
                name: "pH_factor",
                fullName: "pH_factor (pH ê³„ìˆ˜)",
                expression: "pH_factor = f(Rumen_pH)",
                description: "ë°˜ì¶”ìœ„ pHì— ë”°ë¥¸ ê³„ìˆ˜",
                level: 2,
                dependencies: ["Rumen_pH"],
                category: "coefficient",
                hasChildren: true,
                parent: "Rumen_Absorption_Rate"
            },
            "Competition_factor": {
                name: "Competition_factor",
                fullName: "Competition_factor (ê²½ìŸ ê³„ìˆ˜)",
                expression: "Competition_factor = f(Mineral_competition)",
                description: "ë¯¸ë„¤ë„ ê°„ ê²½ìŸì— ë”°ë¥¸ ê³„ìˆ˜",
                level: 2,
                dependencies: ["Mineral_competition"],
                category: "coefficient",
                hasChildren: true,
                parent: "Rumen_Absorption_Rate"
            },
            "Binding_factor": {
                name: "Binding_factor",
                fullName: "Binding_factor (ê²°í•© ê³„ìˆ˜)",
                expression: "Binding_factor = f(Binding_agents)",
                description: "ê²°í•© ë¬¼ì§ˆì— ë”°ë¥¸ ê³„ìˆ˜",
                level: 2,
                dependencies: ["Binding_agents"],
                category: "coefficient",
                hasChildren: true,
                parent: "Rumen_Absorption_Rate"
            },

            // Level 3: Macro_Minerals í•˜ìœ„ ìˆ˜ì‹ë“¤ (ìƒˆë¡œ ì™„ì „ êµ¬í˜„)
            "Ca": {
                name: "Ca",
                fullName: "Ca (ì¹¼ìŠ˜)",
                expression: "Ca = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ì¹¼ìŠ˜ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Macro_Minerals"
            },
            "P": {
                name: "P",
                fullName: "P (ì¸)",
                expression: "P = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ì¸ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Macro_Minerals"
            },
            "Mg": {
                name: "Mg",
                fullName: "Mg (ë§ˆê·¸ë„¤ìŠ˜)",
                expression: "Mg = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ë§ˆê·¸ë„¤ìŠ˜ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Macro_Minerals"
            },
            "K": {
                name: "K",
                fullName: "K (ì¹¼ë¥¨)",
                expression: "K = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ì¹¼ë¥¨ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Macro_Minerals"
            },
            "Na": {
                name: "Na",
                fullName: "Na (ë‚˜íŠ¸ë¥¨)",
                expression: "Na = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ë‚˜íŠ¸ë¥¨ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Macro_Minerals"
            },
            "Cl": {
                name: "Cl",
                fullName: "Cl (ì—¼ì†Œ)",
                expression: "Cl = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ì—¼ì†Œ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Macro_Minerals"
            },
            "S": {
                name: "S",
                fullName: "S (í™©)",
                expression: "S = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "í™© í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Macro_Minerals"
            },

            // Level 3: Micro_Minerals í•˜ìœ„ ìˆ˜ì‹ë“¤ (ìƒˆë¡œ ì™„ì „ êµ¬í˜„)
            "Fe": {
                name: "Fe",
                fullName: "Fe (ì² )",
                expression: "Fe = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ì²  í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Micro_Minerals"
            },
            "Zn": {
                name: "Zn",
                fullName: "Zn (ì•„ì—°)",
                expression: "Zn = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ì•„ì—° í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Micro_Minerals"
            },
            "Cu": {
                name: "Cu",
                fullName: "Cu (êµ¬ë¦¬)",
                expression: "Cu = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "êµ¬ë¦¬ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Micro_Minerals"
            },
            "Mn": {
                name: "Mn",
                fullName: "Mn (ë§ê°„)",
                expression: "Mn = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ë§ê°„ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Micro_Minerals"
            },
            "Se": {
                name: "Se",
                fullName: "Se (ì…€ë ˆëŠ„)",
                expression: "Se = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ì…€ë ˆëŠ„ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Micro_Minerals"
            },
            "Co": {
                name: "Co",
                fullName: "Co (ì½”ë°œíŠ¸)",
                expression: "Co = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ì½”ë°œíŠ¸ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Micro_Minerals"
            },
            "I": {
                name: "I",
                fullName: "I (ìš”ì˜¤ë“œ)",
                expression: "I = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ìš”ì˜¤ë“œ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "mineral",
                hasChildren: false,
                parent: "Micro_Minerals"
            },

            // Level 3: pH_factor í•˜ìœ„ ìˆ˜ì‹ë“¤ (ìƒˆë¡œ ì™„ì „ êµ¬í˜„)
            "Rumen_pH": {
                name: "Rumen_pH",
                fullName: "Rumen_pH (ë°˜ì¶”ìœ„ pH)",
                expression: "Rumen_pH = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ë°˜ì¶”ìœ„ pH",
                level: 3,
                dependencies: [],
                category: "pH",
                hasChildren: false,
                parent: "pH_factor"
            },

            // Level 3: Competition_factor í•˜ìœ„ ìˆ˜ì‹ë“¤ (ìƒˆë¡œ ì™„ì „ êµ¬í˜„)
            "Mineral_competition": {
                name: "Mineral_competition",
                fullName: "Mineral_competition (ë¯¸ë„¤ë„ ê²½ìŸ)",
                expression: "Mineral_competition = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ë¯¸ë„¤ë„ ê°„ ê²½ìŸ ì •ë„",
                level: 3,
                dependencies: [],
                category: "competition",
                hasChildren: false,
                parent: "Competition_factor"
            },

            // Level 3: Binding_factor í•˜ìœ„ ìˆ˜ì‹ë“¤ (ìƒˆë¡œ ì™„ì „ êµ¬í˜„)
            "Binding_agents": {
                name: "Binding_agents",
                fullName: "Binding_agents (ê²°í•© ë¬¼ì§ˆ)",
                expression: "Binding_agents = ê¸°ë³¸ê°’ ë˜ëŠ” ê³„ì‚°ê°’",
                description: "ê²°í•© ë¬¼ì§ˆ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "binding",
                hasChildren: false,
                parent: "Binding_factor"
            },

            // ê¸°ì¡´ ì§€ë°©-ë°˜ì¶”ìœ„ ì²´ì¸ë“¤ (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "Total_Fat": {
                name: "Total_Fat",
                fullName: "Total_Fat (ì´ ì§€ë°©)",
                expression: "Total_Fat = Saturated_Fat + Unsaturated_Fat",
                description: "ì´ ì§€ë°© = í¬í™”ì§€ë°© + ë¶ˆí¬í™”ì§€ë°©",
                level: 1,
                dependencies: ["Saturated_Fat", "Unsaturated_Fat"],
                category: "fat",
                hasChildren: true,
                parent: "Fat_Rumen_Processing"
            },
            "Rumen_Hydrolysis_Rate": {
                name: "Rumen_Hydrolysis_Rate",
                fullName: "Rumen_Hydrolysis_Rate (ë°˜ì¶”ìœ„ ê°€ìˆ˜ë¶„í•´ìœ¨)",
                expression: "Rumen_Hydrolysis_Rate = Base_rate Ã— Lipase_factor Ã— pH_factor Ã— Temp_factor",
                description: "ë°˜ì¶”ìœ„ ê°€ìˆ˜ë¶„í•´ìœ¨ = ê¸°ë³¸ ê°€ìˆ˜ë¶„í•´ìœ¨ Ã— ë¦¬íŒŒì•„ì œ ê³„ìˆ˜ Ã— pH ê³„ìˆ˜ Ã— ì˜¨ë„ ê³„ìˆ˜",
                level: 1,
                dependencies: ["Base_rate", "Lipase_factor", "pH_factor", "Temp_factor"],
                category: "hydrolysis",
                hasChildren: true,
                parent: "Fat_Rumen_Processing"
            },

            // ê¸°ì¡´ íƒ„ìˆ˜í™”ë¬¼-ë°˜ì¶”ìœ„ ì²´ì¸ë“¤ (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "Total_Carbs": {
                name: "Total_Carbs",
                fullName: "Total_Carbs (ì´ íƒ„ìˆ˜í™”ë¬¼)",
                expression: "Total_Carbs = NDF + NFC + Starch",
                description: "ì´ íƒ„ìˆ˜í™”ë¬¼ = ì¤‘ì„±ì„¸ì œì„¬ìœ  + ë¹„ì„¬ìœ ì„±íƒ„ìˆ˜í™”ë¬¼ + ì „ë¶„",
                level: 1,
                dependencies: ["NDF", "NFC", "Starch"],
                category: "carbohydrate",
                hasChildren: true,
                parent: "Carb_Rumen_Processing"
            },
            "Rumen_Fermentation_Rate": {
                name: "Rumen_Fermentation_Rate",
                fullName: "Rumen_Fermentation_Rate (ë°˜ì¶”ìœ„ ë°œíš¨ìœ¨)",
                expression: "Rumen_Fermentation_Rate = Base_rate Ã— NDF_factor Ã— pH_factor",
                description: "ë°˜ì¶”ìœ„ ë°œíš¨ìœ¨ = ê¸°ë³¸ ë°œíš¨ìœ¨ Ã— NDF ê³„ìˆ˜ Ã— pH ê³„ìˆ˜",
                level: 1,
                dependencies: ["Base_rate", "NDF_factor", "pH_factor"],
                category: "fermentation",
                hasChildren: true,
                parent: "Carb_Rumen_Processing"
            },

            // ê¸°ì¡´ ë‹¨ë°±ì§ˆ-ë°˜ì¶”ìœ„ ì²´ì¸ë“¤ (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "Total_Protein": {
                name: "Total_Protein",
                fullName: "Total_Protein (ì´ ë‹¨ë°±ì§ˆ)",
                expression: "Total_Protein = RDP + RUP",
                description: "ì´ ë‹¨ë°±ì§ˆ = ë°˜ì¶”ìœ„ ë¶„í•´ì„± ë‹¨ë°±ì§ˆ + ë°˜ì¶”ìœ„ ë¹„ë¶„í•´ì„± ë‹¨ë°±ì§ˆ",
                level: 1,
                dependencies: ["RDP", "RUP"],
                category: "protein",
                hasChildren: true,
                parent: "Protein_Rumen_Processing"
            },
            "Rumen_Degradation_Rate": {
                name: "Rumen_Degradation_Rate",
                fullName: "Rumen_Degradation_Rate (ë°˜ì¶”ìœ„ ë¶„í•´ìœ¨)",
                expression: "Rumen_Degradation_Rate = Base_rate Ã— Solubility_factor Ã— pH_factor Ã— Temp_factor",
                description: "ë°˜ì¶”ìœ„ ë¶„í•´ìœ¨ = ê¸°ë³¸ ë¶„í•´ìœ¨ Ã— ìš©í•´ë„ ê³„ìˆ˜ Ã— pH ê³„ìˆ˜ Ã— ì˜¨ë„ ê³„ìˆ˜",
                level: 1,
                dependencies: ["Base_rate", "Solubility_factor", "pH_factor", "Temp_factor"],
                category: "degradation",
                hasChildren: true,
                parent: "Protein_Rumen_Processing"
            },

            // ê¸°ì¡´ MP, ME, DMI ì²´ì¸ë“¤ (ê¸°ì¡´ ì™„ì „ êµ¬í˜„)
            "MPfeed": {
                name: "MPfeed",
                fullName: "MPfeed (Feed Protein)",
                expression: "MPfeed = DIGPB1 + DIGPB2 + DIGPB3",
                description: "ì‚¬ë£Œ ë‹¨ë°±ì§ˆ = ì†Œí™” ê°€ëŠ¥ ë‹¨ë°±ì§ˆ 1 + 2 + 3",
                level: 1,
                dependencies: ["DIGPB1", "DIGPB2", "DIGPB3"],
                category: "protein",
                hasChildren: true,
                parent: "MP"
            },
            "MPbact": {
                name: "MPbact",
                fullName: "MPbact (Bacterial Protein)",
                expression: "MPbact = MCP Ã— 0.64",
                description: "ë¯¸ìƒë¬¼ ë‹¨ë°±ì§ˆ = ë¯¸ìƒë¬¼ ì¡°ë‹¨ë°±ì§ˆ Ã— íš¨ìœ¨ì„±",
                level: 1,
                dependencies: ["MCP"],
                category: "protein",
                hasChildren: true,
                parent: "MP"
            },
            "GE": {
                name: "GE",
                fullName: "GE (Gross Energy)",
                expression: "GE = Feed_intake Ã— Energy_content",
                description: "ì´ì—ë„ˆì§€ = ì‚¬ë£Œ ì„­ì·¨ëŸ‰ Ã— ì—ë„ˆì§€ í•¨ëŸ‰",
                level: 1,
                dependencies: ["Feed_intake", "Energy_content"],
                category: "energy",
                hasChildren: true,
                parent: "ME"
            },
            "FE": {
                name: "FE",
                fullName: "FE (Fecal Energy)",
                expression: "FE = Feed_intake Ã— Fecal_loss_rate",
                description: "ë¶„ì—ë„ˆì§€ = ì‚¬ë£Œ ì„­ì·¨ëŸ‰ Ã— ë¶„ ì†ì‹¤ìœ¨",
                level: 1,
                dependencies: ["Feed_intake", "Fecal_loss_rate"],
                category: "energy",
                hasChildren: true,
                parent: "ME"
            },
            "UE": {
                name: "UE",
                fullName: "UE (Urinary Energy)",
                expression: "UE = Protein_intake Ã— Urinary_loss_rate",
                description: "ìš”ì—ë„ˆì§€ = ë‹¨ë°±ì§ˆ ì„­ì·¨ëŸ‰ Ã— ìš” ì†ì‹¤ìœ¨",
                level: 1,
                dependencies: ["Protein_intake", "Urinary_loss_rate"],
                category: "energy",
                hasChildren: true,
                parent: "ME"
            },
            "CH4E": {
                name: "CH4E",
                fullName: "CH4E (Methane Energy)",
                expression: "CH4E = Fermentable_carbs Ã— Methane_factor",
                description: "ë©”íƒ„ì—ë„ˆì§€ = ë°œíš¨ ê°€ëŠ¥ íƒ„ìˆ˜í™”ë¬¼ Ã— ë©”íƒ„ ê³„ìˆ˜",
                level: 1,
                dependencies: ["Fermentable_carbs", "Methane_factor"],
                category: "energy",
                hasChildren: true,
                parent: "ME"
            },
            "ê¸°ë³¸ ì„­ì·¨ëŸ‰": {
                name: "ê¸°ë³¸ ì„­ì·¨ëŸ‰",
                fullName: "ê¸°ë³¸ ì„­ì·¨ëŸ‰ (Basic Intake)",
                expression: "ê¸°ë³¸ ì„­ì·¨ëŸ‰ = ì²´ì¤‘ Ã— ê¸°ë³¸ ì„­ì·¨ìœ¨",
                description: "ê¸°ë³¸ ì„­ì·¨ëŸ‰ = ì²´ì¤‘ Ã— ê¸°ë³¸ ì„­ì·¨ìœ¨",
                level: 1,
                dependencies: ["ì²´ì¤‘", "ê¸°ë³¸ ì„­ì·¨ìœ¨"],
                category: "intake",
                hasChildren: true,
                parent: "DMI"
            },
            "ì¡°ì • ê³„ìˆ˜ë“¤": {
                name: "ì¡°ì • ê³„ìˆ˜ë“¤",
                fullName: "ì¡°ì • ê³„ìˆ˜ë“¤ (Adjustment Factors)",
                expression: "ì¡°ì • ê³„ìˆ˜ë“¤ = ì—ë„ˆì§€ ì¡°ì • Ã— ë‹¨ë°±ì§ˆ ì¡°ì • Ã— ì„¬ìœ ì§ˆ ì¡°ì •",
                description: "ì¡°ì • ê³„ìˆ˜ë“¤ = ì—ë„ˆì§€ ì¡°ì • Ã— ë‹¨ë°±ì§ˆ ì¡°ì • Ã— ì„¬ìœ ì§ˆ ì¡°ì •",
                level: 1,
                dependencies: ["ì—ë„ˆì§€ ì¡°ì •", "ë‹¨ë°±ì§ˆ ì¡°ì •", "ì„¬ìœ ì§ˆ ì¡°ì •"],
                category: "coefficient",
                hasChildren: true,
                parent: "DMI"
            },

            // ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ëª¨ë¸ ì™„ì „ êµ¬í˜„ (ìƒˆë¡œ ì¶”ê°€)
            "Mineral_Rumen_Processing": {
                name: "Mineral_Rumen_Processing",
                fullName: "Mineral_Rumen_Processing (ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ì²˜ë¦¬)",
                expression: "Mineral_Rumen_Processing = Total_Minerals Ã— Rumen_Absorption_Rate",
                description: "ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ì²˜ë¦¬ = ì´ ë¯¸ë„¤ë„ Ã— ë°˜ì¶”ìœ„ í¡ìˆ˜ìœ¨",
                level: 0,
                dependencies: ["Total_Minerals", "Rumen_Absorption_Rate"],
                category: "mineral",
                hasChildren: true,
                parent: null
            },
            "Total_Minerals": {
                name: "Total_Minerals",
                fullName: "Total_Minerals (ì´ ë¯¸ë„¤ë„)",
                expression: "Total_Minerals = Macro_Minerals + Micro_Minerals",
                description: "ì´ ë¯¸ë„¤ë„ = ë‹¤ëŸ‰ ë¯¸ë„¤ë„ + ë¯¸ëŸ‰ ë¯¸ë„¤ë„",
                level: 1,
                dependencies: ["Macro_Minerals", "Micro_Minerals"],
                category: "mineral",
                hasChildren: true,
                parent: "Mineral_Rumen_Processing"
            },
            "Rumen_Absorption_Rate": {
                name: "Rumen_Absorption_Rate",
                fullName: "Rumen_Absorption_Rate (ë°˜ì¶”ìœ„ í¡ìˆ˜ìœ¨)",
                expression: "Rumen_Absorption_Rate = Base_rate Ã— pH_factor Ã— Competition_factor Ã— Binding_factor",
                description: "ë°˜ì¶”ìœ„ í¡ìˆ˜ìœ¨ = ê¸°ë³¸ í¡ìˆ˜ìœ¨ Ã— pH ê³„ìˆ˜ Ã— ê²½ìŸ ê³„ìˆ˜ Ã— ê²°í•© ê³„ìˆ˜",
                level: 1,
                dependencies: ["Base_rate", "pH_factor", "Competition_factor", "Binding_factor"],
                category: "absorption",
                hasChildren: true,
                parent: "Mineral_Rumen_Processing"
            }
            // ... (ê¸°ì¡´ ìˆ˜ì‹ë“¤ ê³„ì†)
        };

        // ìˆ˜ì‹ í†µê³„ ì—…ë°ì´íŠ¸
        function updateFormulaStats() {
            const totalFormulas = Object.keys(formulaDatabase).length;
            const statsElement = document.getElementById('formula-stats');
            if (statsElement) {
                statsElement.textContent = `êµ¬í˜„ëœ ìˆ˜ì‹: ${totalFormulas}ê°œ / ëª©í‘œ: 27,061ê°œ`;
            }
        }

        // ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ê´€ë ¨ ìˆ˜ì‹ì¸ì§€ í™•ì¸
        function isMineralRumenRelated(formulaName) {
            const mineralRumenFormulas = [
                'Mineral_Rumen_Processing', 'Total_Minerals', 'Rumen_Absorption_Rate',
                'Macro_Minerals', 'Micro_Minerals', 'Base_rate', 'pH_factor',
                'Competition_factor', 'Binding_factor', 'Ca', 'P', 'Mg', 'K', 'Na',
                'Cl', 'S', 'Fe', 'Zn', 'Cu', 'Mn', 'Se', 'Co', 'I'
            ];
            return mineralRumenFormulas.includes(formulaName);
        }

        // ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ëª¨ë¸ì— ì§‘ì¤‘
        function focusOnMineralRumen() {
            selectFormula('Mineral_Rumen_Processing');
        }

        // íƒ„ìˆ˜í™”ë¬¼-ë°˜ì¶”ìœ„ ê´€ë ¨ ìˆ˜ì‹ì¸ì§€ í™•ì¸
        function isCarbRumenRelated(formulaName) {
            const carbRumenFormulas = [
                'Carb_Rumen_Processing', 'Total_Carbs', 'Rumen_Fermentation_Rate',
                'NDF', 'NFC', 'Starch', 'Base_rate', 'NDF_factor', 'pH_factor',
                'Cellulose', 'Hemicellulose', 'Lignin', 'Sugars', 'Pectin',
                'Amylose', 'Amylopectin', 'NDF_content', 'Passage_rate', 'Rumen_pH', 'Total_DM'
            ];
            return carbRumenFormulas.includes(formulaName);
        }

        // íƒ„ìˆ˜í™”ë¬¼-ë°˜ì¶”ìœ„ ëª¨ë¸ì— ì§‘ì¤‘
        function focusOnCarbRumen() {
            selectFormula('Carb_Rumen_Processing');
        }

        // ë‹¨ë°±ì§ˆ-ë°˜ì¶”ìœ„ ê´€ë ¨ ìˆ˜ì‹ì¸ì§€ í™•ì¸
        function isProteinRumenRelated(formulaName) {
            const proteinRumenFormulas = [
                'Protein_Rumen_Processing', 'Total_Protein', 'Rumen_Degradation_Rate',
                'RDP', 'RUP', 'Base_rate', 'Solubility_factor', 'pH_factor', 'Temp_factor',
                'Soluble_Protein', 'Rapidly_Degradable_Protein', 'Slowly_Degradable_Protein',
                'Undegradable_Protein', 'Protein_solubility', 'Rumen_pH', 'Rumen_Temperature'
            ];
            return proteinRumenFormulas.includes(formulaName);
        }

        // ë‹¨ë°±ì§ˆ-ë°˜ì¶”ìœ„ ëª¨ë¸ì— ì§‘ì¤‘
        function focusOnProteinRumen() {
            selectFormula('Protein_Rumen_Processing');
        }

        // ì§€ë°©-ë°˜ì¶”ìœ„ ê´€ë ¨ ìˆ˜ì‹ì¸ì§€ í™•ì¸
        function isFatRumenRelated(formulaName) {
            const fatRumenFormulas = [
                'Fat_Rumen_Processing', 'Total_Fat', 'Rumen_Hydrolysis_Rate',
                'Saturated_Fat', 'Unsaturated_Fat', 'Base_rate', 'Lipase_factor',
                'pH_factor', 'Temp_factor', 'Palmitic', 'Stearic', 'Myristic',
                'Oleic', 'Linoleic', 'Linolenic', 'Lipase_activity', 'Rumen_pH', 'Rumen_Temperature'
            ];
            return fatRumenFormulas.includes(formulaName);
        }

        // ì§€ë°©-ë°˜ì¶”ìœ„ ëª¨ë¸ì— ì§‘ì¤‘
        function focusOnFatRumen() {
            selectFormula('Fat_Rumen_Processing');
        }

        // MP ê´€ë ¨ ìˆ˜ì‹ì¸ì§€ í™•ì¸
        function isMPRelated(formulaName) {
            const mpFormulas = ['MP', 'MPfeed', 'MPbact', 'DIGPB1', 'DIGPB2', 'DIGPB3', 'MCP', 'adjREPB1', 'REPB1', 'PeptidePass', 'RDPB1', 'RDPEP'];
            return mpFormulas.includes(formulaName);
        }

        // ME ê´€ë ¨ ìˆ˜ì‹ì¸ì§€ í™•ì¸
        function isMERelated(formulaName) {
            const meFormulas = ['ME', 'GE', 'FE', 'UE', 'CH4E', 'Feed_intake', 'Energy_content', 'Fecal_loss_rate', 'Protein_intake', 'Urinary_loss_rate', 'Fermentable_carbs', 'Methane_factor'];
            return meFormulas.includes(formulaName);
        }

        // DMI ê´€ë ¨ ìˆ˜ì‹ì¸ì§€ í™•ì¸
        function isDMIRelated(formulaName) {
            const dmiFormulas = ['DMI', 'ê¸°ë³¸ ì„­ì·¨ëŸ‰', 'ì¡°ì • ê³„ìˆ˜ë“¤', 'ì²´ì¤‘', 'ê¸°ë³¸ ì„­ì·¨ìœ¨', 'ì—ë„ˆì§€ ì¡°ì •', 'ë‹¨ë°±ì§ˆ ì¡°ì •', 'ì„¬ìœ ì§ˆ ì¡°ì •'];
            return dmiFormulas.includes(formulaName);
        }

        // ìˆ˜ì‹ ì„ íƒ ë° ê³„ì¸µ êµ¬ì¡° ìƒì„±
        function selectFormula(formulaName) {
            selectedFormula = formulaName;
            renderSinglePath();
            updateFormulaDetails();
        }

        // ë‹¨ì¼ ê²½ë¡œ ë Œë”ë§ (ê¸°ì¡´ ê²½ë¡œ ì§€ìš°ê³  ìƒˆë¡œ ê·¸ë¦¬ê¸°)
        function renderSinglePath() {
            const treeContainer = document.getElementById('formula-tree');
            treeContainer.innerHTML = '';
            
            if (!selectedFormula || !formulaDatabase[selectedFormula]) {
                return;
            }

            const formula = formulaDatabase[selectedFormula];
            createHierarchy(formula, 0);
        }

        // ìˆ˜ì‹ ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateFormulaDetails() {
            const detailsElement = document.getElementById('selected-formula-details');
            if (!selectedFormula || !formulaDatabase[selectedFormula]) {
                detailsElement.innerHTML = '<p>ìˆ˜ì‹ì„ ì„ íƒí•˜ì„¸ìš”.</p>';
                return;
            }

            const formula = formulaDatabase[selectedFormula];
            detailsElement.innerHTML = `
                <h3>${formula.fullName}</h3>
                <p><strong>ìˆ˜ì‹:</strong> ${formula.expression}</p>
                <p><strong>ì„¤ëª…:</strong> ${formula.description}</p>
                <p><strong>ì¹´í…Œê³ ë¦¬:</strong> ${formula.category}</p>
                <p><strong>ë ˆë²¨:</strong> ${formula.level}</p>
            `;
        }

        // ê³„ì¸µ êµ¬ì¡° ìƒì„±
        function createHierarchy(formula, level) {
            const treeContainer = document.getElementById('formula-tree');
            
            // ë ˆë²¨ ì»¨í…Œì´ë„ˆ ìƒì„±
            let levelContainer = document.getElementById(`level-${level}`);
            if (!levelContainer) {
                levelContainer = document.createElement('div');
                levelContainer.id = `level-${level}`;
                levelContainer.className = `level-container ${level === 0 ? 'top-level' : ''}`;
                treeContainer.appendChild(levelContainer);
            }

            // ìˆ˜ì‹ ë Œë”ë§
            renderFormulaWithVariables(formula, levelContainer, level);
        }

        // ìˆ˜ì‹ê³¼ ë³€ìˆ˜ë“¤ì„ í•¨ê»˜ ë Œë”ë§
        function renderFormulaWithVariables(formula, container, level) {
            const formulaDiv = document.createElement('div');
            formulaDiv.className = 'formula-container';
            
            // ìˆ˜ì‹ í‘œí˜„ì‹ í‘œì‹œ
            const expressionDiv = document.createElement('div');
            expressionDiv.className = 'formula-expression';
            expressionDiv.innerHTML = `<strong>${formula.expression}</strong>`;
            formulaDiv.appendChild(expressionDiv);

            // ì˜ì¡´ì„± ë²„íŠ¼ë“¤ ìƒì„±
            if (formula.dependencies && formula.dependencies.length > 0) {
                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'dependency-buttons';
                
                formula.dependencies.forEach(depName => {
                    const depFormula = formulaDatabase[depName];
                    if (depFormula) {
                        const button = document.createElement('button');
                        button.className = `formula-button ${getFormulaClass(depFormula)}`;
                        button.textContent = depName;
                        button.title = depFormula.fullName;
                        button.onclick = () => expandPathFormula(depName, level + 1);
                        buttonsContainer.appendChild(button);
                    }
                });
                
                formulaDiv.appendChild(buttonsContainer);
            }

            container.appendChild(formulaDiv);
        }

        // ìˆ˜ì‹ í´ë˜ìŠ¤ ê²°ì •
        function getFormulaClass(formula) {
            if (isMineralRumenRelated(formula.name)) return 'mineral-rumen-related';
            if (isCarbRumenRelated(formula.name)) return 'carb-rumen-related';
            if (isProteinRumenRelated(formula.name)) return 'protein-rumen-related';
            if (isFatRumenRelated(formula.name)) return 'fat-rumen-related';
            if (isMPRelated(formula.name)) return 'mp-related';
            if (isMERelated(formula.name)) return 'me-related';
            if (isDMIRelated(formula.name)) return 'dmi-related';
            return '';
        }

        // ê²½ë¡œ í™•ì¥
        function expandPathFormula(formulaName, level) {
            const formula = formulaDatabase[formulaName];
            if (!formula) return;

            // í˜„ì¬ ë ˆë²¨ ì´í›„ì˜ ëª¨ë“  ë ˆë²¨ ì œê±°
            removeLevelsAfter(level - 1);

            // ìƒˆ ë ˆë²¨ ìƒì„±
            createHierarchy(formula, level);
        }

        // íŠ¹ì • ë ˆë²¨ ì´í›„ì˜ ëª¨ë“  ë ˆë²¨ ì œê±°
        function removeLevelsAfter(level) {
            const treeContainer = document.getElementById('formula-tree');
            const levelsToRemove = treeContainer.querySelectorAll(`[id^="level-"]`);
            
            levelsToRemove.forEach(levelElement => {
                const levelNum = parseInt(levelElement.id.split('-')[1]);
                if (levelNum > level) {
                    levelElement.remove();
                }
            });
        }

        // Decision Tree í˜•íƒœì˜ ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± (D3.js)
        function generateNetworkDiagram() {
            const container = d3.select('#network-diagram');
            container.html(''); // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê¸°
            
            const width = container.node().getBoundingClientRect().width;
            const height = 600;
            
            const svg = container.append('svg')
                .attr('width', width)
                .attr('height', height);

            // íŠ¸ë¦¬ ë°ì´í„° êµ¬ì¡° ìƒì„±
            const treeData = createTreeData();
            
            // íŠ¸ë¦¬ ë ˆì´ì•„ì›ƒ ì„¤ì •
            const treeLayout = d3.tree()
                .size([width - 100, height - 100])
                .separation((a, b) => (a.parent === b.parent ? 1 : 1.2));

            // ë£¨íŠ¸ ë…¸ë“œ ìƒì„±
            const root = d3.hierarchy(treeData);
            treeLayout(root);

            // ì¤Œ ê¸°ëŠ¥ ì¶”ê°€
            const zoom = d3.zoom()
                .scaleExtent([0.1, 3])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });

            svg.call(zoom);

            // ë©”ì¸ ê·¸ë£¹ ìƒì„±
            const g = svg.append('g')
                .attr('transform', `translate(50, 50)`);

            // ë§í¬ ê·¸ë¦¬ê¸°
            const link = g.selectAll('.link')
                .data(root.links())
                .enter().append('path')
                .attr('class', 'link')
                .attr('d', d3.linkVertical()
                    .x(d => d.x)
                    .y(d => d.y))
                .attr('fill', 'none')
                .attr('stroke', '#999')
                .attr('stroke-width', 2)
                .attr('stroke-opacity', 0.6);

            // ë…¸ë“œ ê·¸ë£¹ ìƒì„±
            const node = g.selectAll('.node')
                .data(root.descendants())
                .enter().append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x}, ${d.y})`);

            // ë…¸ë“œ ì› ê·¸ë¦¬ê¸°
            node.append('circle')
                .attr('r', d => getNodeRadius(d.data.level))
                .attr('fill', d => getNodeColor(d.data.category))
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .on('click', function(event, d) {
                    // ë…¸ë“œ í´ë¦­ ì‹œ í•´ë‹¹ ìˆ˜ì‹ ì„ íƒ
                    if (d.data.name && formulaDatabase[d.data.name]) {
                        selectFormula(d.data.name);
                    }
                })
                .on('mouseover', function(event, d) {
                    // íˆ´íŒ í‘œì‹œ
                    showTooltip(event, d);
                })
                .on('mouseout', function() {
                    hideTooltip();
                });

            // ë…¸ë“œ ë¼ë²¨ ê·¸ë¦¬ê¸°
            node.append('text')
                .attr('dy', d => d.children ? -15 : 15)
                .attr('text-anchor', 'middle')
                .attr('font-size', d => getFontSize(d.data.level))
                .attr('font-weight', 'bold')
                .attr('fill', '#333')
                .text(d => d.data.name)
                .style('pointer-events', 'none');

            // ë ˆë²¨ë³„ ë¼ë²¨ ì¶”ê°€
            const levelLabels = ['Level 0', 'Level 1', 'Level 2', 'Level 3'];
            levelLabels.forEach((label, i) => {
                svg.append('text')
                    .attr('x', 10)
                    .attr('y', 50 + i * 80)
                    .attr('font-size', '14px')
                    .attr('font-weight', 'bold')
                    .attr('fill', '#667eea')
                    .text(label);
            });

            // ë…¸ë“œ ë°˜ì§€ë¦„ ê²°ì •
            function getNodeRadius(level) {
                const radii = { 0: 12, 1: 10, 2: 8, 3: 6 };
                return radii[level] || 6;
            }

            // í°íŠ¸ í¬ê¸° ê²°ì •
            function getFontSize(level) {
                const sizes = { 0: '12px', 1: '11px', 2: '10px', 3: '9px' };
                return sizes[level] || '9px';
            }

            // ë…¸ë“œ ìƒ‰ìƒ ê²°ì •
            function getNodeColor(category) {
                const colors = {
                    'protein': '#ff6b6b',
                    'energy': '#4ecdc4',
                    'intake': '#45b7d1',
                    'mineral': '#96ceb4',
                    'carbohydrate_rumen': '#4caf50',
                    'protein_rumen': '#2196f3',
                    'fat_rumen': '#ff9800',
                    'mineral_rumen': '#9c27b0',
                    'absorption': '#e91e63',
                    'fermentation': '#54a0ff',
                    'degradation': '#5f27cd',
                    'hydrolysis': '#ff5722',
                    'coefficient': '#00d2d3',
                    'pH': '#795548',
                    'competition': '#607d8b',
                    'binding': '#9e9e9e'
                };
                return colors[category] || '#95a5a6';
            }

            // íˆ´íŒ í‘œì‹œ
            function showTooltip(event, d) {
                const tooltip = d3.select('body').append('div')
                    .attr('class', 'tooltip')
                    .style('position', 'absolute')
                    .style('background', 'rgba(0,0,0,0.8)')
                    .style('color', 'white')
                    .style('padding', '10px')
                    .style('border-radius', '5px')
                    .style('font-size', '12px')
                    .style('pointer-events', 'none')
                    .style('z-index', '1000');

                const formula = formulaDatabase[d.data.name];
                if (formula) {
                    tooltip.html(`
                        <strong>${formula.fullName}</strong><br/>
                        ${formula.expression}<br/>
                        Level: ${formula.level}<br/>
                        Category: ${formula.category}
                    `);
                } else {
                    tooltip.html(`<strong>${d.data.name}</strong>`);
                }

                tooltip.style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
            }

            // íˆ´íŒ ìˆ¨ê¸°ê¸°
            function hideTooltip() {
                d3.selectAll('.tooltip').remove();
            }
        }

        // íŠ¸ë¦¬ ë°ì´í„° êµ¬ì¡° ìƒì„±
        function createTreeData() {
            // Level 0 (ìµœìƒìœ„) ìˆ˜ì‹ë“¤ ì°¾ê¸°
            const level0Formulas = Object.keys(formulaDatabase).filter(name => 
                formulaDatabase[name].level === 0
            );

            // ì²« ë²ˆì§¸ Level 0 ìˆ˜ì‹ì„ ë£¨íŠ¸ë¡œ ì‚¬ìš©
            const rootName = level0Formulas[0] || 'MP';
            const rootFormula = formulaDatabase[rootName];

            return {
                name: rootName,
                level: rootFormula ? rootFormula.level : 0,
                category: rootFormula ? rootFormula.category : 'unknown',
                children: createChildren(rootName, 1)
            };
        }

        // ìì‹ ë…¸ë“œ ìƒì„± (ì¬ê·€ì )
        function createChildren(parentName, currentLevel) {
            const parent = formulaDatabase[parentName];
            if (!parent || !parent.dependencies || currentLevel > 3) {
                return [];
            }

            return parent.dependencies
                .filter(dep => formulaDatabase[dep])
                .map(dep => {
                    const depFormula = formulaDatabase[dep];
                    return {
                        name: dep,
                        level: depFormula.level,
                        category: depFormula.category,
                        children: createChildren(dep, currentLevel + 1)
                    };
                });
        }

        // Decision Tree ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì–´ê·¸ë¨ í‘œì‹œ í•¨ìˆ˜ë“¤
        function showMPChain() {
            // MP ì²´ì¸ë§Œ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ ìƒì„±
            generateSpecificTree('MP');
        }

        function showMEChain() {
            // ME ì²´ì¸ë§Œ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ ìƒì„±
            generateSpecificTree('ME');
        }

        function showDMIChain() {
            // DMI ì²´ì¸ë§Œ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ ìƒì„±
            generateSpecificTree('DMI');
        }

        function showCarbRumenChain() {
            // íƒ„ìˆ˜í™”ë¬¼-ë°˜ì¶”ìœ„ ì²´ì¸ë§Œ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ ìƒì„±
            generateSpecificTree('Carb_Rumen_Processing');
        }

        function showProteinRumenChain() {
            // ë‹¨ë°±ì§ˆ-ë°˜ì¶”ìœ„ ì²´ì¸ë§Œ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ ìƒì„±
            generateSpecificTree('Protein_Rumen_Processing');
        }

        function showFatRumenChain() {
            // ì§€ë°©-ë°˜ì¶”ìœ„ ì²´ì¸ë§Œ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ ìƒì„±
            generateSpecificTree('Fat_Rumen_Processing');
        }

        function showMineralRumenChain() {
            // ë¯¸ë„¤ë„-ë°˜ì¶”ìœ„ ì²´ì¸ë§Œ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ ìƒì„±
            generateSpecificTree('Mineral_Rumen_Processing');
        }

        function showAllNodes() {
            // ëª¨ë“  Level 0 ìˆ˜ì‹ë“¤ì„ í¬í•¨í•œ í†µí•© íŠ¸ë¦¬ ìƒì„±
            generateAllLevel0Tree();
        }

        function showSelectedPath() {
            // í˜„ì¬ ì„ íƒëœ ìˆ˜ì‹ì˜ ê²½ë¡œë§Œ í‘œì‹œ
            if (selectedFormula) {
                generateSpecificTree(selectedFormula);
            }
        }

        function showTopLevel() {
            // Level 0 ìˆ˜ì‹ë“¤ë§Œ í‘œì‹œ
            generateTopLevelTree();
        }

        function zoomIn() {
            // í™•ëŒ€
            const svg = d3.select('#network-diagram svg');
            const currentTransform = d3.zoomTransform(svg.node());
            const newScale = currentTransform.k * 1.2;
            svg.transition().duration(300).call(
                d3.zoom().transform,
                d3.zoomIdentity.scale(newScale).translate(currentTransform.x, currentTransform.y)
            );
        }

        function zoomOut() {
            // ì¶•ì†Œ
            const svg = d3.select('#network-diagram svg');
            const currentTransform = d3.zoomTransform(svg.node());
            const newScale = currentTransform.k / 1.2;
            svg.transition().duration(300).call(
                d3.zoom().transform,
                d3.zoomIdentity.scale(newScale).translate(currentTransform.x, currentTransform.y)
            );
        }

        function resetZoom() {
            // í™•ëŒ€/ì¶•ì†Œ ë¦¬ì…‹
            const svg = d3.select('#network-diagram svg');
            svg.transition().duration(300).call(
                d3.zoom().transform,
                d3.zoomIdentity
            );
        }

        // íŠ¹ì • ìˆ˜ì‹ì˜ íŠ¸ë¦¬ ìƒì„±
        function generateSpecificTree(rootName) {
            const container = d3.select('#network-diagram');
            container.html('');
            
            const width = container.node().getBoundingClientRect().width;
            const height = 600;
            
            const svg = container.append('svg')
                .attr('width', width)
                .attr('height', height);

            // íŠ¹ì • ìˆ˜ì‹ì„ ë£¨íŠ¸ë¡œ í•˜ëŠ” íŠ¸ë¦¬ ë°ì´í„° ìƒì„±
            const treeData = {
                name: rootName,
                level: formulaDatabase[rootName] ? formulaDatabase[rootName].level : 0,
                category: formulaDatabase[rootName] ? formulaDatabase[rootName].category : 'unknown',
                children: createChildren(rootName, 1)
            };

            // íŠ¸ë¦¬ ë ˆì´ì•„ì›ƒ ì„¤ì •
            const treeLayout = d3.tree()
                .size([width - 100, height - 100])
                .separation((a, b) => (a.parent === b.parent ? 1 : 1.2));

            // ë£¨íŠ¸ ë…¸ë“œ ìƒì„±
            const root = d3.hierarchy(treeData);
            treeLayout(root);

            // ì¤Œ ê¸°ëŠ¥ ì¶”ê°€
            const zoom = d3.zoom()
                .scaleExtent([0.1, 3])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });

            svg.call(zoom);

            // ë©”ì¸ ê·¸ë£¹ ìƒì„±
            const g = svg.append('g')
                .attr('transform', `translate(50, 50)`);

            // ë§í¬ ê·¸ë¦¬ê¸°
            const link = g.selectAll('.link')
                .data(root.links())
                .enter().append('path')
                .attr('class', 'link')
                .attr('d', d3.linkVertical()
                    .x(d => d.x)
                    .y(d => d.y))
                .attr('fill', 'none')
                .attr('stroke', '#999')
                .attr('stroke-width', 2)
                .attr('stroke-opacity', 0.6);

            // ë…¸ë“œ ê·¸ë£¹ ìƒì„±
            const node = g.selectAll('.node')
                .data(root.descendants())
                .enter().append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x}, ${d.y})`);

            // ë…¸ë“œ ì› ê·¸ë¦¬ê¸°
            node.append('circle')
                .attr('r', d => getNodeRadius(d.data.level))
                .attr('fill', d => getNodeColor(d.data.category))
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .on('click', function(event, d) {
                    if (d.data.name && formulaDatabase[d.data.name]) {
                        selectFormula(d.data.name);
                    }
                })
                .on('mouseover', function(event, d) {
                    showTooltip(event, d);
                })
                .on('mouseout', function() {
                    hideTooltip();
                });

            // ë…¸ë“œ ë¼ë²¨ ê·¸ë¦¬ê¸°
            node.append('text')
                .attr('dy', d => d.children ? -15 : 15)
                .attr('text-anchor', 'middle')
                .attr('font-size', d => getFontSize(d.data.level))
                .attr('font-weight', 'bold')
                .attr('fill', '#333')
                .text(d => d.data.name)
                .style('pointer-events', 'none');

            // í—¬í¼ í•¨ìˆ˜ë“¤
            function getNodeRadius(level) {
                const radii = { 0: 12, 1: 10, 2: 8, 3: 6 };
                return radii[level] || 6;
            }

            function getFontSize(level) {
                const sizes = { 0: '12px', 1: '11px', 2: '10px', 3: '9px' };
                return sizes[level] || '9px';
            }

            function getNodeColor(category) {
                const colors = {
                    'protein': '#ff6b6b',
                    'energy': '#4ecdc4',
                    'intake': '#45b7d1',
                    'mineral': '#96ceb4',
                    'carbohydrate_rumen': '#4caf50',
                    'protein_rumen': '#2196f3',
                    'fat_rumen': '#ff9800',
                    'mineral_rumen': '#9c27b0',
                    'absorption': '#e91e63',
                    'fermentation': '#54a0ff',
                    'degradation': '#5f27cd',
                    'hydrolysis': '#ff5722',
                    'coefficient': '#00d2d3',
                    'pH': '#795548',
                    'competition': '#607d8b',
                    'binding': '#9e9e9e'
                };
                return colors[category] || '#95a5a6';
            }

            function showTooltip(event, d) {
                const tooltip = d3.select('body').append('div')
                    .attr('class', 'tooltip')
                    .style('position', 'absolute')
                    .style('background', 'rgba(0,0,0,0.8)')
                    .style('color', 'white')
                    .style('padding', '10px')
                    .style('border-radius', '5px')
                    .style('font-size', '12px')
                    .style('pointer-events', 'none')
                    .style('z-index', '1000');

                const formula = formulaDatabase[d.data.name];
                if (formula) {
                    tooltip.html(`
                        <strong>${formula.fullName}</strong><br/>
                        ${formula.expression}<br/>
                        Level: ${formula.level}<br/>
                        Category: ${formula.category}
                    `);
                } else {
                    tooltip.html(`<strong>${d.data.name}</strong>`);
                }

                tooltip.style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
            }

            function hideTooltip() {
                d3.selectAll('.tooltip').remove();
            }
        }

        // ëª¨ë“  Level 0 ìˆ˜ì‹ë“¤ì„ í¬í•¨í•œ í†µí•© íŠ¸ë¦¬ ìƒì„±
        function generateAllLevel0Tree() {
            const container = d3.select('#network-diagram');
            container.html('');
            
            const width = container.node().getBoundingClientRect().width;
            const height = 600;
            
            const svg = container.append('svg')
                .attr('width', width)
                .attr('height', height);

            // ëª¨ë“  Level 0 ìˆ˜ì‹ë“¤ì„ ê°€ìƒì˜ ë£¨íŠ¸ ë…¸ë“œë¡œ ì—°ê²°
            const level0Formulas = Object.keys(formulaDatabase).filter(name => 
                formulaDatabase[name].level === 0
            );

            const treeData = {
                name: 'All_Level_0',
                level: -1,
                category: 'root',
                children: level0Formulas.map(name => ({
                    name: name,
                    level: formulaDatabase[name].level,
                    category: formulaDatabase[name].category,
                    children: createChildren(name, 1)
                }))
            };

            // íŠ¸ë¦¬ ë ˆì´ì•„ì›ƒ ì„¤ì •
            const treeLayout = d3.tree()
                .size([width - 100, height - 100])
                .separation((a, b) => (a.parent === b.parent ? 1 : 1.2));

            // ë£¨íŠ¸ ë…¸ë“œ ìƒì„±
            const root = d3.hierarchy(treeData);
            treeLayout(root);

            // ì¤Œ ê¸°ëŠ¥ ì¶”ê°€
            const zoom = d3.zoom()
                .scaleExtent([0.1, 3])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });

            svg.call(zoom);

            // ë©”ì¸ ê·¸ë£¹ ìƒì„±
            const g = svg.append('g')
                .attr('transform', `translate(50, 50)`);

            // ë§í¬ ê·¸ë¦¬ê¸°
            const link = g.selectAll('.link')
                .data(root.links())
                .enter().append('path')
                .attr('class', 'link')
                .attr('d', d3.linkVertical()
                    .x(d => d.x)
                    .y(d => d.y))
                .attr('fill', 'none')
                .attr('stroke', '#999')
                .attr('stroke-width', 2)
                .attr('stroke-opacity', 0.6);

            // ë…¸ë“œ ê·¸ë£¹ ìƒì„±
            const node = g.selectAll('.node')
                .data(root.descendants())
                .enter().append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x}, ${d.y})`);

            // ë…¸ë“œ ì› ê·¸ë¦¬ê¸°
            node.append('circle')
                .attr('r', d => getNodeRadius(d.data.level))
                .attr('fill', d => getNodeColor(d.data.category))
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .on('click', function(event, d) {
                    if (d.data.name && formulaDatabase[d.data.name]) {
                        selectFormula(d.data.name);
                    }
                })
                .on('mouseover', function(event, d) {
                    showTooltip(event, d);
                })
                .on('mouseout', function() {
                    hideTooltip();
                });

            // ë…¸ë“œ ë¼ë²¨ ê·¸ë¦¬ê¸°
            node.append('text')
                .attr('dy', d => d.children ? -15 : 15)
                .attr('text-anchor', 'middle')
                .attr('font-size', d => getFontSize(d.data.level))
                .attr('font-weight', 'bold')
                .attr('fill', '#333')
                .text(d => d.data.name)
                .style('pointer-events', 'none');

            // í—¬í¼ í•¨ìˆ˜ë“¤ (ìœ„ì™€ ë™ì¼)
            function getNodeRadius(level) {
                const radii = { -1: 15, 0: 12, 1: 10, 2: 8, 3: 6 };
                return radii[level] || 6;
            }

            function getFontSize(level) {
                const sizes = { -1: '14px', 0: '12px', 1: '11px', 2: '10px', 3: '9px' };
                return sizes[level] || '9px';
            }

            function getNodeColor(category) {
                const colors = {
                    'root': '#333',
                    'protein': '#ff6b6b',
                    'energy': '#4ecdc4',
                    'intake': '#45b7d1',
                    'mineral': '#96ceb4',
                    'carbohydrate_rumen': '#4caf50',
                    'protein_rumen': '#2196f3',
                    'fat_rumen': '#ff9800',
                    'mineral_rumen': '#9c27b0',
                    'absorption': '#e91e63',
                    'fermentation': '#54a0ff',
                    'degradation': '#5f27cd',
                    'hydrolysis': '#ff5722',
                    'coefficient': '#00d2d3',
                    'pH': '#795548',
                    'competition': '#607d8b',
                    'binding': '#9e9e9e'
                };
                return colors[category] || '#95a5a6';
            }

            function showTooltip(event, d) {
                const tooltip = d3.select('body').append('div')
                    .attr('class', 'tooltip')
                    .style('position', 'absolute')
                    .style('background', 'rgba(0,0,0,0.8)')
                    .style('color', 'white')
                    .style('padding', '10px')
                    .style('border-radius', '5px')
                    .style('font-size', '12px')
                    .style('pointer-events', 'none')
                    .style('z-index', '1000');

                if (d.data.name === 'All_Level_0') {
                    tooltip.html(`<strong>ëª¨ë“  Level 0 ìˆ˜ì‹ë“¤</strong><br/>ì´ ${level0Formulas.length}ê°œ`);
                } else {
                    const formula = formulaDatabase[d.data.name];
                    if (formula) {
                        tooltip.html(`
                            <strong>${formula.fullName}</strong><br/>
                            ${formula.expression}<br/>
                            Level: ${formula.level}<br/>
                            Category: ${formula.category}
                        `);
                    } else {
                        tooltip.html(`<strong>${d.data.name}</strong>`);
                    }
                }

                tooltip.style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
            }

            function hideTooltip() {
                d3.selectAll('.tooltip').remove();
            }
        }

        // Level 0 ìˆ˜ì‹ë“¤ë§Œ í‘œì‹œí•˜ëŠ” íŠ¸ë¦¬ ìƒì„±
        function generateTopLevelTree() {
            const container = d3.select('#network-diagram');
            container.html('');
            
            const width = container.node().getBoundingClientRect().width;
            const height = 600;
            
            const svg = container.append('svg')
                .attr('width', width)
                .attr('height', height);

            // Level 0 ìˆ˜ì‹ë“¤ë§Œ ìˆ˜í‰ìœ¼ë¡œ ë°°ì¹˜
            const level0Formulas = Object.keys(formulaDatabase).filter(name => 
                formulaDatabase[name].level === 0
            );

            const nodeWidth = width / (level0Formulas.length + 1);
            const nodeHeight = 100;

            // ì¤Œ ê¸°ëŠ¥ ì¶”ê°€
            const zoom = d3.zoom()
                .scaleExtent([0.1, 3])
                .on('zoom', (event) => {
                    g.attr('transform', event.transform);
                });

            svg.call(zoom);

            // ë©”ì¸ ê·¸ë£¹ ìƒì„±
            const g = svg.append('g')
                .attr('transform', `translate(50, 50)`);

            // Level 0 ë…¸ë“œë“¤ ê·¸ë¦¬ê¸°
            level0Formulas.forEach((name, i) => {
                const x = (i + 1) * nodeWidth;
                const y = nodeHeight;

                // ë…¸ë“œ ê·¸ë£¹
                const nodeGroup = g.append('g')
                    .attr('class', 'node')
                    .attr('transform', `translate(${x}, ${y})`);

                // ë…¸ë“œ ì›
                nodeGroup.append('circle')
                    .attr('r', 15)
                    .attr('fill', getNodeColor(formulaDatabase[name].category))
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2)
                    .style('cursor', 'pointer')
                    .on('click', function() {
                        selectFormula(name);
                    })
                    .on('mouseover', function(event) {
                        showTooltip(event, { data: { name: name } });
                    })
                    .on('mouseout', function() {
                        hideTooltip();
                    });

                // ë…¸ë“œ ë¼ë²¨
                nodeGroup.append('text')
                    .attr('dy', -20)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '12px')
                    .attr('font-weight', 'bold')
                    .attr('fill', '#333')
                    .text(name)
                    .style('pointer-events', 'none');

                // Level í‘œì‹œ
                nodeGroup.append('text')
                    .attr('dy', 25)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '10px')
                    .attr('fill', '#666')
                    .text('Level 0')
                    .style('pointer-events', 'none');
            });

            // í—¬í¼ í•¨ìˆ˜ë“¤
            function getNodeColor(category) {
                const colors = {
                    'protein': '#ff6b6b',
                    'energy': '#4ecdc4',
                    'intake': '#45b7d1',
                    'mineral': '#96ceb4',
                    'carbohydrate_rumen': '#4caf50',
                    'protein_rumen': '#2196f3',
                    'fat_rumen': '#ff9800',
                    'mineral_rumen': '#9c27b0'
                };
                return colors[category] || '#95a5a6';
            }

            function showTooltip(event, d) {
                const tooltip = d3.select('body').append('div')
                    .attr('class', 'tooltip')
                    .style('position', 'absolute')
                    .style('background', 'rgba(0,0,0,0.8)')
                    .style('color', 'white')
                    .style('padding', '10px')
                    .style('border-radius', '5px')
                    .style('font-size', '12px')
                    .style('pointer-events', 'none')
                    .style('z-index', '1000');

                const formula = formulaDatabase[d.data.name];
                if (formula) {
                    tooltip.html(`
                        <strong>${formula.fullName}</strong><br/>
                        ${formula.expression}<br/>
                        Level: ${formula.level}<br/>
                        Category: ${formula.category}
                    `);
                }

                tooltip.style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px');
            }

            function hideTooltip() {
                d3.selectAll('.tooltip').remove();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('í˜ì´ì§€ ë¡œë“œë¨');
            console.log('formulaDatabase í¬ê¸°:', Object.keys(formulaDatabase).length);
            updateFormulaStats();
            
            // ê¸°ë³¸ ìˆ˜ì‹ ì„ íƒ
            if (Object.keys(formulaDatabase).length > 0) {
                const firstFormula = Object.keys(formulaDatabase)[0];
                selectFormula(firstFormula);
            }
            
            // ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±
            setTimeout(() => {
                generateNetworkDiagram();
            }, 100);
        });

        // ìˆ˜ì‹ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ìˆ˜ì •
        function updateFormulaStats() {
            const totalFormulas = Object.keys(formulaDatabase).length;
            const statsElement = document.getElementById('implemented-formulas');
            if (statsElement) {
                statsElement.textContent = totalFormulas;
            }
            
            const rateElement = document.getElementById('implementation-rate');
            if (rateElement) {
                const rate = ((totalFormulas / 27061) * 100).toFixed(2);
                rateElement.textContent = rate + '%';
            }
            
            const remainingElement = document.getElementById('remaining-formulas');
            if (remainingElement) {
                remainingElement.textContent = (27061 - totalFormulas);
            }
        }

        // ìˆ˜ì‹ ì„ íƒ í•¨ìˆ˜ ìˆ˜ì •
        function selectFormula(formulaName) {
            console.log('ìˆ˜ì‹ ì„ íƒ:', formulaName);
            selectedFormula = formulaName;
            renderSinglePath();
            updateFormulaDetails();
        }

        // ë‹¨ì¼ ê²½ë¡œ ë Œë”ë§ í•¨ìˆ˜ ìˆ˜ì •
        function renderSinglePath() {
            console.log('ë‹¨ì¼ ê²½ë¡œ ë Œë”ë§ ì‹œì‘');
            const treeContainer = document.getElementById('formula-tree');
            if (!treeContainer) {
                console.error('formula-tree ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            treeContainer.innerHTML = '';
            
            if (!selectedFormula || !formulaDatabase[selectedFormula]) {
                console.log('ì„ íƒëœ ìˆ˜ì‹ì´ ì—†ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            const formula = formulaDatabase[selectedFormula];
            console.log('ë Œë”ë§í•  ìˆ˜ì‹:', formula);
            createHierarchy(formula, 0);
        }

        // ê³„ì¸µ êµ¬ì¡° ìƒì„± í•¨ìˆ˜ ìˆ˜ì •
        function createHierarchy(formula, level) {
            console.log('ê³„ì¸µ êµ¬ì¡° ìƒì„±:', formula.name, 'ë ˆë²¨:', level);
            const treeContainer = document.getElementById('formula-tree');
            if (!treeContainer) {
                console.error('formula-tree ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            // ë ˆë²¨ ì»¨í…Œì´ë„ˆ ìƒì„±
            let levelContainer = document.getElementById(`level-${level}`);
            if (!levelContainer) {
                levelContainer = document.createElement('div');
                levelContainer.id = `level-${level}`;
                levelContainer.className = `level-container ${level === 0 ? 'top-level' : ''}`;
                treeContainer.appendChild(levelContainer);
            }

            // ìˆ˜ì‹ ë Œë”ë§
            renderFormulaWithVariables(formula, levelContainer, level);
        }

        // ìˆ˜ì‹ê³¼ ë³€ìˆ˜ë“¤ì„ í•¨ê»˜ ë Œë”ë§ í•¨ìˆ˜ ìˆ˜ì •
        function renderFormulaWithVariables(formula, container, level) {
            console.log('ìˆ˜ì‹ ë Œë”ë§:', formula.name);
            const formulaDiv = document.createElement('div');
            formulaDiv.className = 'formula-container';
            
            // ìˆ˜ì‹ í‘œí˜„ì‹ í‘œì‹œ
            const expressionDiv = document.createElement('div');
            expressionDiv.className = 'formula-expression';
            expressionDiv.innerHTML = `<strong>${formula.expression}</strong>`;
            formulaDiv.appendChild(expressionDiv);

            // ì˜ì¡´ì„± ë²„íŠ¼ë“¤ ìƒì„±
            if (formula.dependencies && formula.dependencies.length > 0) {
                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'dependency-buttons';
                
                formula.dependencies.forEach(depName => {
                    const depFormula = formulaDatabase[depName];
                    if (depFormula) {
                        const button = document.createElement('button');
                        button.className = `formula-button ${getFormulaClass(depFormula)}`;
                        button.textContent = depName;
                        button.title = depFormula.fullName;
                        button.onclick = () => expandPathFormula(depName, level + 1);
                        buttonsContainer.appendChild(button);
                    }
                });
                
                formulaDiv.appendChild(buttonsContainer);
            }

            container.appendChild(formulaDiv);
        }

        // ìˆ˜ì‹ í´ë˜ìŠ¤ ê²°ì • í•¨ìˆ˜ ìˆ˜ì •
        function getFormulaClass(formula) {
            if (isMineralRumenRelated(formula.name)) return 'mineral-rumen-related';
            if (isCarbRumenRelated(formula.name)) return 'carb-rumen-related';
            if (isProteinRumenRelated(formula.name)) return 'protein-rumen-related';
            if (isFatRumenRelated(formula.name)) return 'fat-rumen-related';
            if (isMPRelated(formula.name)) return 'mp-related';
            if (isMERelated(formula.name)) return 'me-related';
            if (isDMIRelated(formula.name)) return 'dmi-related';
            return '';
        }

        // ê²½ë¡œ í™•ì¥ í•¨ìˆ˜ ìˆ˜ì •
        function expandPathFormula(formulaName, level) {
            console.log('ê²½ë¡œ í™•ì¥:', formulaName, 'ë ˆë²¨:', level);
            const formula = formulaDatabase[formulaName];
            if (!formula) return;

            // í˜„ì¬ ë ˆë²¨ ì´í›„ì˜ ëª¨ë“  ë ˆë²¨ ì œê±°
            removeLevelsAfter(level - 1);

            // ìƒˆ ë ˆë²¨ ìƒì„±
            createHierarchy(formula, level);
        }

        // íŠ¹ì • ë ˆë²¨ ì´í›„ì˜ ëª¨ë“  ë ˆë²¨ ì œê±° í•¨ìˆ˜ ìˆ˜ì •
        function removeLevelsAfter(level) {
            const treeContainer = document.getElementById('formula-tree');
            if (!treeContainer) return;
            
            const levelsToRemove = treeContainer.querySelectorAll(`[id^="level-"]`);
            
            levelsToRemove.forEach(levelElement => {
                const levelNum = parseInt(levelElement.id.split('-')[1]);
                if (levelNum > level) {
                    levelElement.remove();
                }
            });
        }

        // ìˆ˜ì‹ ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ìˆ˜ì •
        function updateFormulaDetails() {
            const detailsElement = document.getElementById('selected-formula-details');
            if (!detailsElement) {
                console.error('selected-formula-details ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            if (!selectedFormula || !formulaDatabase[selectedFormula]) {
                detailsElement.innerHTML = '<p>ìˆ˜ì‹ì„ ì„ íƒí•˜ì„¸ìš”.</p>';
                return;
            }

            const formula = formulaDatabase[selectedFormula];
            detailsElement.innerHTML = `
                <h3>${formula.fullName}</h3>
                <p><strong>ìˆ˜ì‹:</strong> ${formula.expression}</p>
                <p><strong>ì„¤ëª…:</strong> ${formula.description}</p>
                <p><strong>ì¹´í…Œê³ ë¦¬:</strong> ${formula.category}</p>
                <p><strong>ë ˆë²¨:</strong> ${formula.level}</p>
            `;
        }
    </script>
</body>
</html>
