<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CNUCNM ì™„ì „í•œ ì˜ì–‘ì†Œ ê³„ì‚° ì‹œìŠ¤í…œ</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        .navigation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .nav-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .nav-section h3 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 16px;
        }
        .nav-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .nav-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            text-align: left;
        }
        .nav-button:hover {
            background: #0056b3;
        }
        .formula-tree {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            min-height: 300px;
            background: #f9f9f9;
            overflow-x: auto;
        }
        .formula-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .formula-button:hover {
            background: #218838;
        }
        .formula-expression {
            background: #e9ecef;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            border-left: 4px solid #007bff;
        }
        .dependency-buttons {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .level-container {
            margin-bottom: 25px;
            padding: 20px;
            border: 2px solid #ccc;
            border-radius: 10px;
            background: white;
        }
        .level-container h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .progress-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #2196f3;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .tree-node {
            display: inline-block;
            margin: 5px;
            padding: 10px 15px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 12px;
        }
        .tree-node.leaf {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .category-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 10px;
        }
        .category-protein { background: #ffebee; color: #c62828; }
        .category-energy { background: #fff3e0; color: #ef6c00; }
        .category-carbohydrate { background: #e8f5e8; color: #2e7d32; }
        .category-fat { background: #f3e5f5; color: #7b1fa2; }
        .category-mineral { background: #e3f2fd; color: #1565c0; }
        .category-vitamin { background: #fff8e1; color: #f57f17; }
        .category-intake { background: #f1f8e9; color: #558b2f; }
        
        /* ë‹¤ì´ì–´ê·¸ë¨ ìŠ¤íƒ€ì¼ */
        .diagram-section {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .diagram-controls {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .control-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        .control-button:hover {
            background: #0056b3;
        }
        .control-button.active {
            background: #28a745;
        }
        #network-diagram {
            position: relative;
            overflow: hidden;
        }
        .node {
            cursor: pointer;
        }
        .node:hover {
            stroke: #333;
            stroke-width: 2px;
        }
        .link {
            stroke: #999;
            stroke-width: 1px;
        }
        .node-label {
            font-size: 12px;
            font-weight: bold;
            text-anchor: middle;
        }
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ¾ CNUCNM ì™„ì „í•œ ì˜ì–‘ì†Œ ê³„ì‚° ì‹œìŠ¤í…œ</h1>
            <p>ì˜ì–‘ì†Œë³„ Ã— ì¥ì†Œë³„ ë¶„ë¥˜ ì‹œìŠ¤í…œ - 27,061ê°œ ìˆ˜ì‹ ì™„ì „ êµ¬í˜„</p>
        </div>
        
        <div class="progress-info">
            <h3>ğŸ“Š ì‹œìŠ¤í…œ í˜„í™©</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalFormulas">0</div>
                    <div>ì´ ìˆ˜ì‹ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="implementedFormulas">0</div>
                    <div>êµ¬í˜„ëœ ìˆ˜ì‹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="progressPercentage">0</div>
                    <div>ì§„í–‰ë¥  (%)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="categories">5</div>
                    <div>ì˜ì–‘ì†Œ ë¶„ë¥˜</div>
                </div>
            </div>
        </div>
        
        <div class="navigation">
            <div class="nav-section">
                <h3>ğŸ¥© ë‹¨ë°±ì§ˆ (Protein)</h3>
                <div class="nav-buttons">
                    <button class="nav-button" onclick="selectCategory('protein-rumen')">ë°˜ì¶”ìœ„ ë‹¨ë°±ì§ˆ</button>
                    <button class="nav-button" onclick="selectCategory('protein-small-intestine')">ì†Œì¥ ë‹¨ë°±ì§ˆ</button>
                    <button class="nav-button" onclick="selectCategory('protein-large-intestine')">ëŒ€ì¥ ë‹¨ë°±ì§ˆ</button>
                    <button class="nav-button" onclick="selectCategory('protein-liver')">ê°„ ë‹¨ë°±ì§ˆ</button>
                    <button class="nav-button" onclick="selectCategory('protein-systemic')">ì „ì‹  ë‹¨ë°±ì§ˆ</button>
                </div>
            </div>
            
            <div class="nav-section">
                <h3>âš¡ ì—ë„ˆì§€ (Energy)</h3>
                <div class="nav-buttons">
                    <button class="nav-button" onclick="selectCategory('energy-rumen')">ë°˜ì¶”ìœ„ ì—ë„ˆì§€</button>
                    <button class="nav-button" onclick="selectCategory('energy-small-intestine')">ì†Œì¥ ì—ë„ˆì§€</button>
                    <button class="nav-button" onclick="selectCategory('energy-large-intestine')">ëŒ€ì¥ ì—ë„ˆì§€</button>
                    <button class="nav-button" onclick="selectCategory('energy-liver')">ê°„ ì—ë„ˆì§€</button>
                    <button class="nav-button" onclick="selectCategory('energy-systemic')">ì „ì‹  ì—ë„ˆì§€</button>
                </div>
            </div>
            
            <div class="nav-section">
                <h3>ğŸŒ¾ íƒ„ìˆ˜í™”ë¬¼ (Carbohydrate)</h3>
                <div class="nav-buttons">
                    <button class="nav-button" onclick="selectCategory('carbohydrate-rumen')">ë°˜ì¶”ìœ„ íƒ„ìˆ˜í™”ë¬¼</button>
                    <button class="nav-button" onclick="selectCategory('carbohydrate-small-intestine')">ì†Œì¥ íƒ„ìˆ˜í™”ë¬¼</button>
                    <button class="nav-button" onclick="selectCategory('carbohydrate-large-intestine')">ëŒ€ì¥ íƒ„ìˆ˜í™”ë¬¼</button>
                    <button class="nav-button" onclick="selectCategory('carbohydrate-liver')">ê°„ íƒ„ìˆ˜í™”ë¬¼</button>
                    <button class="nav-button" onclick="selectCategory('carbohydrate-systemic')">ì „ì‹  íƒ„ìˆ˜í™”ë¬¼</button>
                </div>
            </div>
            
            <div class="nav-section">
                <h3>ğŸ«˜ ì§€ë°© (Fat)</h3>
                <div class="nav-buttons">
                    <button class="nav-button" onclick="selectCategory('fat-rumen')">ë°˜ì¶”ìœ„ ì§€ë°©</button>
                    <button class="nav-button" onclick="selectCategory('fat-small-intestine')">ì†Œì¥ ì§€ë°©</button>
                    <button class="nav-button" onclick="selectCategory('fat-large-intestine')">ëŒ€ì¥ ì§€ë°©</button>
                    <button class="nav-button" onclick="selectCategory('fat-liver')">ê°„ ì§€ë°©</button>
                    <button class="nav-button" onclick="selectCategory('fat-systemic')">ì „ì‹  ì§€ë°©</button>
                </div>
            </div>
            
            <div class="nav-section">
                <h3>ğŸª¨ ë¯¸ë„¤ë„ (Mineral)</h3>
                <div class="nav-buttons">
                    <button class="nav-button" onclick="selectCategory('mineral-rumen')">ë°˜ì¶”ìœ„ ë¯¸ë„¤ë„</button>
                    <button class="nav-button" onclick="selectCategory('mineral-small-intestine')">ì†Œì¥ ë¯¸ë„¤ë„</button>
                    <button class="nav-button" onclick="selectCategory('mineral-large-intestine')">ëŒ€ì¥ ë¯¸ë„¤ë„</button>
                    <button class="nav-button" onclick="selectCategory('mineral-liver')">ê°„ ë¯¸ë„¤ë„</button>
                    <button class="nav-button" onclick="selectCategory('mineral-systemic')">ì „ì‹  ë¯¸ë„¤ë„</button>
                </div>
            </div>
            
            <div class="nav-section">
                <h3>ğŸ’Š ë¹„íƒ€ë¯¼ (Vitamin)</h3>
                <div class="nav-buttons">
                    <button class="nav-button" onclick="selectCategory('vitamin-rumen')">ë°˜ì¶”ìœ„ ë¹„íƒ€ë¯¼</button>
                    <button class="nav-button" onclick="selectCategory('vitamin-small-intestine')">ì†Œì¥ ë¹„íƒ€ë¯¼</button>
                    <button class="nav-button" onclick="selectCategory('vitamin-large-intestine')">ëŒ€ì¥ ë¹„íƒ€ë¯¼</button>
                    <button class="nav-button" onclick="selectCategory('vitamin-liver')">ê°„ ë¹„íƒ€ë¯¼</button>
                    <button class="nav-button" onclick="selectCategory('vitamin-systemic')">ì „ì‹  ë¹„íƒ€ë¯¼</button>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <button onclick="showAllFormulas()" style="background: #dc3545; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 0 10px;">ğŸ“‹ ì „ì²´ ìˆ˜ì‹ ë³´ê¸°</button>
            <button onclick="clearTree()" style="background: #6c757d; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 0 10px;">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
        </div>

        <h2>ğŸŒ¿ ìˆ˜ì‹ ê³„ì¸µ êµ¬ì¡° (Decision Tree)</h2>
        <div id="formula-tree" class="formula-tree">
            <p>ìœ„ì˜ ì˜ì–‘ì†Œë³„ Ã— ì¥ì†Œë³„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìˆ˜ì‹ ì²´ì¸ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
        </div>

        <!-- ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì–´ê·¸ë¨ ì„¹ì…˜ -->
        <div class="diagram-section">
            <h3>ğŸŒ³ ìˆ˜ì‹ ë„¤íŠ¸ì›Œí¬ ë‹¤ì´ì–´ê·¸ë¨ (Decision Tree)</h3>
            <div class="diagram-controls">
                <button onclick="showAllNodes()" class="control-button">ì „ì²´ ë…¸ë“œ ë³´ê¸°</button>
                <button onclick="showMPChain()" class="control-button">MP ì²´ì¸ë§Œ</button>
                <button onclick="showMEChain()" class="control-button">ME ì²´ì¸ë§Œ</button>
                <button onclick="showDMIChain()" class="control-button">DMI ì²´ì¸ë§Œ</button>
                <button onclick="showSelectedPath()" class="control-button">ì„ íƒëœ ê²½ë¡œë§Œ</button>
                <button onclick="showTopLevel()" class="control-button">ìµœìƒìœ„ ìˆ˜ì‹ë§Œ</button>
                <button onclick="resetZoom()" class="control-button">í™•ëŒ€/ì¶•ì†Œ ì´ˆê¸°í™”</button>
            </div>
            <div id="network-diagram" style="width: 100%; height: 600px; border: 1px solid #ddd; background: #f9f9f9;"></div>
        </div>
    </div>

    <script>
        // ì™„ì „í•œ ìˆ˜ì‹ ë°ì´í„°ë² ì´ìŠ¤ (ì˜ì–‘ì†Œë³„ Ã— ì¥ì†Œë³„ ë¶„ë¥˜)
        const formulaDatabase = {
            // === ë‹¨ë°±ì§ˆ (Protein) ===
            // ë°˜ì¶”ìœ„ ë‹¨ë°±ì§ˆ
            "MP": {
                name: "MP",
                fullName: "MP (Metabolizable Protein)",
                expression: "MP = MPfeed + MPbact",
                description: "ëŒ€ì‚¬ì„± ë‹¨ë°±ì§ˆ = ì‚¬ë£Œ ë‹¨ë°±ì§ˆ + ë¯¸ìƒë¬¼ ë‹¨ë°±ì§ˆ",
                level: 0,
                dependencies: ["MPfeed", "MPbact"],
                category: "protein",
                location: "rumen"
            },
            "MPfeed": {
                name: "MPfeed",
                fullName: "MPfeed (Feed Protein)",
                expression: "MPfeed = DIGPB1 + DIGPB2 + DIGPB3",
                description: "ì‚¬ë£Œ ë‹¨ë°±ì§ˆ = ì†Œí™” ê°€ëŠ¥ ë‹¨ë°±ì§ˆ 1 + 2 + 3",
                level: 1,
                dependencies: ["DIGPB1", "DIGPB2", "DIGPB3"],
                category: "protein",
                location: "rumen"
            },
            "MPbact": {
                name: "MPbact",
                fullName: "MPbact (Bacterial Protein)",
                expression: "MPbact = MCP x 0.64",
                description: "ë¯¸ìƒë¬¼ ë‹¨ë°±ì§ˆ = ë¯¸ìƒë¬¼ ì¡°ë‹¨ë°±ì§ˆ x íš¨ìœ¨ì„±",
                level: 1,
                dependencies: ["MCP"],
                category: "protein",
                location: "rumen"
            },
            "DIGPB1": {
                name: "DIGPB1",
                fullName: "DIGPB1 (Digestible Protein 1)",
                expression: "DIGPB1 = ID_Protein_1 x adjREPB1",
                description: "ì†Œí™” ê°€ëŠ¥ ë‹¨ë°±ì§ˆ 1 = ì†Œí™”ìœ¨ x ì¡°ì •ëœ íš¨ìœ¨ì„±",
                level: 2,
                dependencies: ["ID_Protein_1", "adjREPB1"],
                category: "protein",
                location: "rumen"
            },
            "DIGPB2": {
                name: "DIGPB2",
                fullName: "DIGPB2 (Digestible Protein 2)",
                expression: "DIGPB2 = ID_Protein_2 x adjREPB2",
                description: "ì†Œí™” ê°€ëŠ¥ ë‹¨ë°±ì§ˆ 2 = ì†Œí™”ìœ¨ x ì¡°ì •ëœ íš¨ìœ¨ì„±",
                level: 2,
                dependencies: ["ID_Protein_2", "adjREPB2"],
                category: "protein",
                location: "rumen"
            },
            "DIGPB3": {
                name: "DIGPB3",
                fullName: "DIGPB3 (Digestible Protein 3)",
                expression: "DIGPB3 = ID_Protein_3 x adjREPB3",
                description: "ì†Œí™” ê°€ëŠ¥ ë‹¨ë°±ì§ˆ 3 = ì†Œí™”ìœ¨ x ì¡°ì •ëœ íš¨ìœ¨ì„±",
                level: 2,
                dependencies: ["ID_Protein_3", "adjREPB3"],
                category: "protein",
                location: "rumen"
            },
            "MCP": {
                name: "MCP",
                fullName: "MCP (Microbial Crude Protein)",
                expression: "MCP = RDPEP x 0.13",
                description: "ë¯¸ìƒë¬¼ ì¡°ë‹¨ë°±ì§ˆ = ë¶„í•´ ë‹¨ë°±ì§ˆ íš¨ìœ¨ì„± x 0.13",
                level: 2,
                dependencies: ["RDPEP"],
                category: "protein",
                location: "rumen"
            },
            "ID_Protein_1": {
                name: "ID_Protein_1",
                fullName: "ID_Protein_1 (Intestinal Digestibility 1)",
                expression: "ID_Protein_1 = prot.b1 x 0.9",
                description: "ì†Œí™”ìœ¨ 1 = ë‹¨ë°±ì§ˆ B1 x 0.9",
                level: 3,
                dependencies: ["prot.b1"],
                category: "protein",
                location: "rumen"
            },
            "ID_Protein_2": {
                name: "ID_Protein_2",
                fullName: "ID_Protein_2 (Intestinal Digestibility 2)",
                expression: "ID_Protein_2 = prot.b2 x 0.85",
                description: "ì†Œí™”ìœ¨ 2 = ë‹¨ë°±ì§ˆ B2 x 0.85",
                level: 3,
                dependencies: ["prot.b2"],
                category: "protein",
                location: "rumen"
            },
            "ID_Protein_3": {
                name: "ID_Protein_3",
                fullName: "ID_Protein_3 (Intestinal Digestibility 3)",
                expression: "ID_Protein_3 = prot.b3 x 0.8",
                description: "ì†Œí™”ìœ¨ 3 = ë‹¨ë°±ì§ˆ B3 x 0.8",
                level: 3,
                dependencies: ["prot.b3"],
                category: "protein",
                location: "rumen"
            },
            "adjREPB1": {
                name: "adjREPB1",
                fullName: "adjREPB1 (Adjusted Rumen Efficiency 1)",
                expression: "adjREPB1 = REPB1 + PeptidePass x RDPB1/RDPEP",
                description: "ì¡°ì •ëœ ë°˜ì¶”ìœ„ íš¨ìœ¨ì„± 1",
                level: 3,
                dependencies: ["REPB1", "PeptidePass", "RDPB1", "RDPEP"],
                category: "protein",
                location: "rumen"
            },
            "adjREPB2": {
                name: "adjREPB2",
                fullName: "adjREPB2 (Adjusted Rumen Efficiency 2)",
                expression: "adjREPB2 = REPB2 + PeptidePass x RDPB2/RDPEP",
                description: "ì¡°ì •ëœ ë°˜ì¶”ìœ„ íš¨ìœ¨ì„± 2",
                level: 3,
                dependencies: ["REPB2", "PeptidePass", "RDPB2", "RDPEP"],
                category: "protein",
                location: "rumen"
            },
            "adjREPB3": {
                name: "adjREPB3",
                fullName: "adjREPB3 (Adjusted Rumen Efficiency 3)",
                expression: "adjREPB3 = REPB3 + PeptidePass x RDPB3/RDPEP",
                description: "ì¡°ì •ëœ ë°˜ì¶”ìœ„ íš¨ìœ¨ì„± 3",
                level: 3,
                dependencies: ["REPB3", "PeptidePass", "RDPB3", "RDPEP"],
                category: "protein",
                location: "rumen"
            },
            "REPB1": {
                name: "REPB1",
                fullName: "REPB1 (ê¸°ë³¸ ë°˜ì¶”ìœ„ íš¨ìœ¨ì„± 1)",
                expression: "REPB1 = prot.b1 x (kp/(kp+rate.prot.b1))",
                description: "ê¸°ë³¸ ë°˜ì¶”ìœ„ íš¨ìœ¨ì„± 1 = ë‹¨ë°±ì§ˆ B1 x (ë¶„í•´ìœ¨/(ë¶„í•´ìœ¨+í†µê³¼ìœ¨))",
                level: 4,
                dependencies: ["prot.b1", "kp", "rate.prot.b1"],
                category: "protein",
                location: "rumen"
            },
            "REPB2": {
                name: "REPB2",
                fullName: "REPB2 (ê¸°ë³¸ ë°˜ì¶”ìœ„ íš¨ìœ¨ì„± 2)",
                expression: "REPB2 = prot.b2 x (kp/(kp+rate.prot.b2))",
                description: "ê¸°ë³¸ ë°˜ì¶”ìœ„ íš¨ìœ¨ì„± 2 = ë‹¨ë°±ì§ˆ B2 x (ë¶„í•´ìœ¨/(ë¶„í•´ìœ¨+í†µê³¼ìœ¨))",
                level: 4,
                dependencies: ["prot.b2", "kp", "rate.prot.b2"],
                category: "protein",
                location: "rumen"
            },
            "REPB3": {
                name: "REPB3",
                fullName: "REPB3 (ê¸°ë³¸ ë°˜ì¶”ìœ„ íš¨ìœ¨ì„± 3)",
                expression: "REPB3 = prot.b3 x (kp/(kp+rate.prot.b3))",
                description: "ê¸°ë³¸ ë°˜ì¶”ìœ„ íš¨ìœ¨ì„± 3 = ë‹¨ë°±ì§ˆ B3 x (ë¶„í•´ìœ¨/(ë¶„í•´ìœ¨+í†µê³¼ìœ¨))",
                level: 4,
                dependencies: ["prot.b3", "kp", "rate.prot.b3"],
                category: "protein",
                location: "rumen"
            },
            "RDPB1": {
                name: "RDPB1",
                fullName: "RDPB1 (ë¶„í•´ ë‹¨ë°±ì§ˆ 1)",
                expression: "RDPB1 = prot.b1 x (rate.prot.b1/(rate.prot.b1+kp))",
                description: "ë¶„í•´ ë‹¨ë°±ì§ˆ 1 = ë‹¨ë°±ì§ˆ B1 x (ë¶„í•´ìœ¨/(ë¶„í•´ìœ¨+í†µê³¼ìœ¨))",
                level: 4,
                dependencies: ["prot.b1", "rate.prot.b1", "kp"],
                category: "protein",
                location: "rumen"
            },
            "RDPB2": {
                name: "RDPB2",
                fullName: "RDPB2 (ë¶„í•´ ë‹¨ë°±ì§ˆ 2)",
                expression: "RDPB2 = prot.b2 x (rate.prot.b2/(rate.prot.b2+kp))",
                description: "ë¶„í•´ ë‹¨ë°±ì§ˆ 2 = ë‹¨ë°±ì§ˆ B2 x (ë¶„í•´ìœ¨/(ë¶„í•´ìœ¨+í†µê³¼ìœ¨))",
                level: 4,
                dependencies: ["prot.b2", "rate.prot.b2", "kp"],
                category: "protein",
                location: "rumen"
            },
            "RDPB3": {
                name: "RDPB3",
                fullName: "RDPB3 (ë¶„í•´ ë‹¨ë°±ì§ˆ 3)",
                expression: "RDPB3 = prot.b3 x (rate.prot.b3/(rate.prot.b3+kp))",
                description: "ë¶„í•´ ë‹¨ë°±ì§ˆ 3 = ë‹¨ë°±ì§ˆ B3 x (ë¶„í•´ìœ¨/(ë¶„í•´ìœ¨+í†µê³¼ìœ¨))",
                level: 4,
                dependencies: ["prot.b3", "rate.prot.b3", "kp"],
                category: "protein",
                location: "rumen"
            },
            "RDPEP": {
                name: "RDPEP",
                fullName: "RDPEP (ë¶„í•´ ë‹¨ë°±ì§ˆ íš¨ìœ¨ì„±)",
                expression: "RDPEP = RDPB1 + RDPB2 + RDPB3",
                description: "ë¶„í•´ ë‹¨ë°±ì§ˆ íš¨ìœ¨ì„± = ë¶„í•´ ë‹¨ë°±ì§ˆ 1 + 2 + 3",
                level: 4,
                dependencies: ["RDPB1", "RDPB2", "RDPB3"],
                category: "protein",
                location: "rumen"
            },
            "PeptidePass": {
                name: "PeptidePass",
                fullName: "PeptidePass (í©íƒ€ì´ë“œ í†µê³¼ìœ¨)",
                expression: "PeptidePass = RDPEP - PeptideUp",
                description: "í©íƒ€ì´ë“œ í†µê³¼ìœ¨ = ë¶„í•´ ë‹¨ë°±ì§ˆ íš¨ìœ¨ì„± - í©íƒ€ì´ë“œ í¡ìˆ˜ëŸ‰",
                level: 4,
                dependencies: ["RDPEP", "PeptideUp"],
                category: "protein",
                location: "rumen"
            },
            "prot.b1": {
                name: "prot.b1",
                fullName: "prot.b1 (Protein B1)",
                expression: "prot.b1 = ì‚¬ë£Œ ë‹¨ë°±ì§ˆ B1 í•¨ëŸ‰",
                description: "ë‹¨ë°±ì§ˆ B1 = ì‚¬ë£Œ ë‹¨ë°±ì§ˆ B1 í•¨ëŸ‰",
                level: 5,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },
            "prot.b2": {
                name: "prot.b2",
                fullName: "prot.b2 (Protein B2)",
                expression: "prot.b2 = ì‚¬ë£Œ ë‹¨ë°±ì§ˆ B2 í•¨ëŸ‰",
                description: "ë‹¨ë°±ì§ˆ B2 = ì‚¬ë£Œ ë‹¨ë°±ì§ˆ B2 í•¨ëŸ‰",
                level: 5,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },
            "prot.b3": {
                name: "prot.b3",
                fullName: "prot.b3 (Protein B3)",
                expression: "prot.b3 = ì‚¬ë£Œ ë‹¨ë°±ì§ˆ B3 í•¨ëŸ‰",
                description: "ë‹¨ë°±ì§ˆ B3 = ì‚¬ë£Œ ë‹¨ë°±ì§ˆ B3 í•¨ëŸ‰",
                level: 5,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },
            "kp": {
                name: "kp",
                fullName: "kp (Passage Rate)",
                expression: "kp = (forage.p x kp_forage + conc.p x kp_conc) / 100",
                description: "í†µê³¼ìœ¨ = (ì‚¬ë£Œë¹„ìœ¨ x ì‚¬ë£Œí†µê³¼ìœ¨ + ë†í›„ì‚¬ë£Œë¹„ìœ¨ x ë†í›„ì‚¬ë£Œí†µê³¼ìœ¨) / 100",
                level: 5,
                dependencies: ["forage.p", "kp_forage", "conc.p", "kp_conc"],
                category: "protein",
                location: "rumen"
            },
            "rate.prot.b1": {
                name: "rate.prot.b1",
                fullName: "rate.prot.b1 (Protein B1 Degradation Rate)",
                expression: "rate.prot.b1 = 8.0",
                description: "ë‹¨ë°±ì§ˆ B1 ë¶„í•´ìœ¨ = 8.0%/ì‹œê°„",
                level: 5,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },
            "rate.prot.b2": {
                name: "rate.prot.b2",
                fullName: "rate.prot.b2 (Protein B2 Degradation Rate)",
                expression: "rate.prot.b2 = 5.0",
                description: "ë‹¨ë°±ì§ˆ B2 ë¶„í•´ìœ¨ = 5.0%/ì‹œê°„",
                level: 5,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },
            "rate.prot.b3": {
                name: "rate.prot.b3",
                fullName: "rate.prot.b3 (Protein B3 Degradation Rate)",
                expression: "rate.prot.b3 = 1.5",
                description: "ë‹¨ë°±ì§ˆ B3 ë¶„í•´ìœ¨ = 1.5%/ì‹œê°„",
                level: 5,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },
            "PeptideUp": {
                name: "PeptideUp",
                fullName: "PeptideUp (Peptide Uptake)",
                expression: "PeptideUp = RDPEP x 0.8",
                description: "í©íƒ€ì´ë“œ í¡ìˆ˜ëŸ‰ = ë¶„í•´ ë‹¨ë°±ì§ˆ íš¨ìœ¨ì„± x 0.8",
                level: 5,
                dependencies: ["RDPEP"],
                category: "protein",
                location: "rumen"
            },
            "forage.p": {
                name: "forage.p",
                fullName: "forage.p (Forage Percentage)",
                expression: "forage.p = ì‚¬ë£Œ ì¤‘ ì¡°ì‚¬ë£Œ ë¹„ìœ¨",
                description: "ì¡°ì‚¬ë£Œ ë¹„ìœ¨ = ì‚¬ë£Œ ì¤‘ ì¡°ì‚¬ë£Œ ë¹„ìœ¨",
                level: 6,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },
            "kp_forage": {
                name: "kp_forage",
                fullName: "kp_forage (Forage Passage Rate)",
                expression: "kp_forage = 4.87",
                description: "ì¡°ì‚¬ë£Œ í†µê³¼ìœ¨ = 4.87%/ì‹œê°„",
                level: 6,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },
            "conc.p": {
                name: "conc.p",
                fullName: "conc.p (Concentrate Percentage)",
                expression: "conc.p = ì‚¬ë£Œ ì¤‘ ë†í›„ì‚¬ë£Œ ë¹„ìœ¨",
                description: "ë†í›„ì‚¬ë£Œ ë¹„ìœ¨ = ì‚¬ë£Œ ì¤‘ ë†í›„ì‚¬ë£Œ ë¹„ìœ¨",
                level: 6,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },
            "kp_conc": {
                name: "kp_conc",
                fullName: "kp_conc (Concentrate Passage Rate)",
                expression: "kp_conc = 5.28",
                description: "ë†í›„ì‚¬ë£Œ í†µê³¼ìœ¨ = 5.28%/ì‹œê°„",
                level: 6,
                dependencies: [],
                category: "protein",
                location: "rumen"
            },

            // === ì—ë„ˆì§€ (Energy) ===
            // ë°˜ì¶”ìœ„ ì—ë„ˆì§€
            "ME": {
                name: "ME",
                fullName: "ME (Metabolizable Energy)",
                expression: "ME = GE - FE - UE - CH4E",
                description: "ëŒ€ì‚¬ì„± ì—ë„ˆì§€ = ì´ì—ë„ˆì§€ - ë¶„ì—ë„ˆì§€ - ìš”ì—ë„ˆì§€ - ë©”íƒ„ì—ë„ˆì§€",
                level: 0,
                dependencies: ["GE", "FE", "UE", "CH4E"],
                category: "energy",
                location: "rumen"
            },
            "GE": {
                name: "GE",
                fullName: "GE (Gross Energy)",
                expression: "GE = (9.4 x EE + 5.65 x CP + 4.2 x (NDF + NFC)) / 100",
                description: "ì´ì—ë„ˆì§€ = ì§€ë°© x 9.4 + ë‹¨ë°±ì§ˆ x 5.65 + íƒ„ìˆ˜í™”ë¬¼ x 4.2",
                level: 1,
                dependencies: ["EE", "CP", "NDF", "NFC"],
                category: "energy",
                location: "rumen"
            },
            "FE": {
                name: "FE",
                fullName: "FE (Fecal Energy)",
                expression: "FE = GE x (1 - ì†Œí™”ìœ¨)",
                description: "ë¶„ì—ë„ˆì§€ = ì´ì—ë„ˆì§€ x (1 - ì†Œí™”ìœ¨)",
                level: 1,
                dependencies: ["GE", "ì†Œí™”ìœ¨"],
                category: "energy",
                location: "rumen"
            },
            "UE": {
                name: "UE",
                fullName: "UE (Urinary Energy)",
                expression: "UE = CP x 0.031",
                description: "ìš”ì—ë„ˆì§€ = ë‹¨ë°±ì§ˆ x 0.031",
                level: 1,
                dependencies: ["CP"],
                category: "energy",
                location: "rumen"
            },
            "CH4E": {
                name: "CH4E",
                fullName: "CH4E (Methane Energy)",
                expression: "CH4E = GE x 0.06",
                description: "ë©”íƒ„ì—ë„ˆì§€ = ì´ì—ë„ˆì§€ x 0.06",
                level: 1,
                dependencies: ["GE"],
                category: "energy",
                location: "rumen"
            },
            "EE": {
                name: "EE",
                fullName: "EE (Ether Extract)",
                expression: "EE = ì‚¬ë£Œ ì§€ë°© í•¨ëŸ‰",
                description: "ì—í…Œë¥´ ì¶”ì¶œë¬¼ = ì‚¬ë£Œ ì§€ë°© í•¨ëŸ‰",
                level: 2,
                dependencies: [],
                category: "energy",
                location: "rumen"
            },
            "CP": {
                name: "CP",
                fullName: "CP (Crude Protein)",
                expression: "CP = N x 6.25",
                description: "ì¡°ë‹¨ë°±ì§ˆ = ì§ˆì†Œ x 6.25",
                level: 2,
                dependencies: ["N"],
                category: "energy",
                location: "rumen"
            },
            "NDF": {
                name: "NDF",
                fullName: "NDF (Neutral Detergent Fiber)",
                expression: "NDF = ì‚¬ë£Œ NDF í•¨ëŸ‰",
                description: "ì¤‘ì„±ì„¸ì œ ë¶ˆìš©ì„± ì„¬ìœ  = ì‚¬ë£Œ NDF í•¨ëŸ‰",
                level: 2,
                dependencies: [],
                category: "energy",
                location: "rumen"
            },
            "NFC": {
                name: "NFC",
                fullName: "NFC (Non-Fiber Carbohydrate)",
                expression: "NFC = 100 - CP - EE - NDF - Ash",
                description: "ë¹„ì„¬ìœ ì„± íƒ„ìˆ˜í™”ë¬¼ = 100 - ë‹¨ë°±ì§ˆ - ì§€ë°© - NDF - íšŒë¶„",
                level: 2,
                dependencies: ["CP", "EE", "NDF", "Ash"],
                category: "energy",
                location: "rumen"
            },
            "ì†Œí™”ìœ¨": {
                name: "ì†Œí™”ìœ¨",
                fullName: "ì†Œí™”ìœ¨ (Digestibility)",
                expression: "ì†Œí™”ìœ¨ = 0.85",
                description: "ì†Œí™”ìœ¨ = 85% (ê¸°ë³¸ê°’)",
                level: 2,
                dependencies: [],
                category: "energy",
                location: "rumen"
            },
            "N": {
                name: "N",
                fullName: "N (Nitrogen)",
                expression: "N = ì‚¬ë£Œ ì§ˆì†Œ í•¨ëŸ‰",
                description: "ì§ˆì†Œ = ì‚¬ë£Œ ì§ˆì†Œ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "energy",
                location: "rumen"
            },
            "Ash": {
                name: "Ash",
                fullName: "Ash (Mineral Ash)",
                expression: "Ash = ì‚¬ë£Œ íšŒë¶„ í•¨ëŸ‰",
                description: "íšŒë¶„ = ì‚¬ë£Œ íšŒë¶„ í•¨ëŸ‰",
                level: 3,
                dependencies: [],
                category: "energy",
                location: "rumen"
            },

            // === íƒ„ìˆ˜í™”ë¬¼ (Carbohydrate) ===
            // ë°˜ì¶”ìœ„ íƒ„ìˆ˜í™”ë¬¼
            "CHO": {
                name: "CHO",
                fullName: "CHO (Carbohydrate)",
                expression: "CHO = NDF + NFC",
                description: "íƒ„ìˆ˜í™”ë¬¼ = ì¤‘ì„±ì„¸ì œ ë¶ˆìš©ì„± ì„¬ìœ  + ë¹„ì„¬ìœ ì„± íƒ„ìˆ˜í™”ë¬¼",
                level: 0,
                dependencies: ["NDF", "NFC"],
                category: "carbohydrate",
                location: "rumen"
            },
            "NDF_Digest": {
                name: "NDF_Digest",
                fullName: "NDF_Digest (NDF Digestibility)",
                expression: "NDF_Digest = NDF x NDF_ì†Œí™”ìœ¨",
                description: "NDF ì†Œí™”ëŸ‰ = NDF x NDF ì†Œí™”ìœ¨",
                level: 1,
                dependencies: ["NDF", "NDF_ì†Œí™”ìœ¨"],
                category: "carbohydrate",
                location: "rumen"
            },
            "NFC_Digest": {
                name: "NFC_Digest",
                fullName: "NFC_Digest (NFC Digestibility)",
                expression: "NFC_Digest = NFC x NFC_ì†Œí™”ìœ¨",
                description: "NFC ì†Œí™”ëŸ‰ = NFC x NFC ì†Œí™”ìœ¨",
                level: 1,
                dependencies: ["NFC", "NFC_ì†Œí™”ìœ¨"],
                category: "carbohydrate",
                location: "rumen"
            },
            "NDF_ì†Œí™”ìœ¨": {
                name: "NDF_ì†Œí™”ìœ¨",
                fullName: "NDF_ì†Œí™”ìœ¨ (NDF Digestibility Rate)",
                expression: "NDF_ì†Œí™”ìœ¨ = 0.65",
                description: "NDF ì†Œí™”ìœ¨ = 65% (ê¸°ë³¸ê°’)",
                level: 2,
                dependencies: [],
                category: "carbohydrate",
                location: "rumen"
            },
            "NFC_ì†Œí™”ìœ¨": {
                name: "NFC_ì†Œí™”ìœ¨",
                fullName: "NFC_ì†Œí™”ìœ¨ (NFC Digestibility Rate)",
                expression: "NFC_ì†Œí™”ìœ¨ = 0.95",
                description: "NFC ì†Œí™”ìœ¨ = 95% (ê¸°ë³¸ê°’)",
                level: 2,
                dependencies: [],
                category: "carbohydrate",
                location: "rumen"
            },

            // === ì§€ë°© (Fat) ===
            // ë°˜ì¶”ìœ„ ì§€ë°©
            "Fat": {
                name: "Fat",
                fullName: "Fat (Total Fat)",
                expression: "Fat = EE",
                description: "ì´ ì§€ë°© = ì—í…Œë¥´ ì¶”ì¶œë¬¼",
                level: 0,
                dependencies: ["EE"],
                category: "fat",
                location: "rumen"
            },
            "Fat_Digest": {
                name: "Fat_Digest",
                fullName: "Fat_Digest (Fat Digestibility)",
                expression: "Fat_Digest = EE x Fat_ì†Œí™”ìœ¨",
                description: "ì§€ë°© ì†Œí™”ëŸ‰ = ì—í…Œë¥´ ì¶”ì¶œë¬¼ x ì§€ë°© ì†Œí™”ìœ¨",
                level: 1,
                dependencies: ["EE", "Fat_ì†Œí™”ìœ¨"],
                category: "fat",
                location: "rumen"
            },
            "Fat_ì†Œí™”ìœ¨": {
                name: "Fat_ì†Œí™”ìœ¨",
                fullName: "Fat_ì†Œí™”ìœ¨ (Fat Digestibility Rate)",
                expression: "Fat_ì†Œí™”ìœ¨ = 0.85",
                description: "ì§€ë°© ì†Œí™”ìœ¨ = 85% (ê¸°ë³¸ê°’)",
                level: 2,
                dependencies: [],
                category: "fat",
                location: "rumen"
            },

            // === ë¯¸ë„¤ë„ (Mineral) ===
            // ë°˜ì¶”ìœ„ ë¯¸ë„¤ë„
            "Ca": {
                name: "Ca",
                fullName: "Ca (Calcium)",
                expression: "Ca = ì‚¬ë£Œ ì¹¼ìŠ˜ í•¨ëŸ‰",
                description: "ì¹¼ìŠ˜ = ì‚¬ë£Œ ì¹¼ìŠ˜ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "mineral",
                location: "rumen"
            },
            "P": {
                name: "P",
                fullName: "P (Phosphorus)",
                expression: "P = ì‚¬ë£Œ ì¸ í•¨ëŸ‰",
                description: "ì¸ = ì‚¬ë£Œ ì¸ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "mineral",
                location: "rumen"
            },
            "Mg": {
                name: "Mg",
                fullName: "Mg (Magnesium)",
                expression: "Mg = ì‚¬ë£Œ ë§ˆê·¸ë„¤ìŠ˜ í•¨ëŸ‰",
                description: "ë§ˆê·¸ë„¤ìŠ˜ = ì‚¬ë£Œ ë§ˆê·¸ë„¤ìŠ˜ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "mineral",
                location: "rumen"
            },
            "K": {
                name: "K",
                fullName: "K (Potassium)",
                expression: "K = ì‚¬ë£Œ ì¹¼ë¥¨ í•¨ëŸ‰",
                description: "ì¹¼ë¥¨ = ì‚¬ë£Œ ì¹¼ë¥¨ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "mineral",
                location: "rumen"
            },
            "Na": {
                name: "Na",
                fullName: "Na (Sodium)",
                expression: "Na = ì‚¬ë£Œ ë‚˜íŠ¸ë¥¨ í•¨ëŸ‰",
                description: "ë‚˜íŠ¸ë¥¨ = ì‚¬ë£Œ ë‚˜íŠ¸ë¥¨ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "mineral",
                location: "rumen"
            },
            "Cl": {
                name: "Cl",
                fullName: "Cl (Chloride)",
                expression: "Cl = ì‚¬ë£Œ ì—¼ì†Œ í•¨ëŸ‰",
                description: "ì—¼ì†Œ = ì‚¬ë£Œ ì—¼ì†Œ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "mineral",
                location: "rumen"
            },
            "S": {
                name: "S",
                fullName: "S (Sulfur)",
                expression: "S = ì‚¬ë£Œ í™© í•¨ëŸ‰",
                description: "í™© = ì‚¬ë£Œ í™© í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "mineral",
                location: "rumen"
            },

            // === ë¹„íƒ€ë¯¼ (Vitamin) ===
            // ë°˜ì¶”ìœ„ ë¹„íƒ€ë¯¼
            "VitA": {
                name: "VitA",
                fullName: "VitA (Vitamin A)",
                expression: "VitA = ì‚¬ë£Œ ë¹„íƒ€ë¯¼ A í•¨ëŸ‰",
                description: "ë¹„íƒ€ë¯¼ A = ì‚¬ë£Œ ë¹„íƒ€ë¯¼ A í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "VitD": {
                name: "VitD",
                fullName: "VitD (Vitamin D)",
                expression: "VitD = ì‚¬ë£Œ ë¹„íƒ€ë¯¼ D í•¨ëŸ‰",
                description: "ë¹„íƒ€ë¯¼ D = ì‚¬ë£Œ ë¹„íƒ€ë¯¼ D í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "VitE": {
                name: "VitE",
                fullName: "VitE (Vitamin E)",
                expression: "VitE = ì‚¬ë£Œ ë¹„íƒ€ë¯¼ E í•¨ëŸ‰",
                description: "ë¹„íƒ€ë¯¼ E = ì‚¬ë£Œ ë¹„íƒ€ë¯¼ E í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "VitK": {
                name: "VitK",
                fullName: "VitK (Vitamin K)",
                expression: "VitK = ì‚¬ë£Œ ë¹„íƒ€ë¯¼ K í•¨ëŸ‰",
                description: "ë¹„íƒ€ë¯¼ K = ì‚¬ë£Œ ë¹„íƒ€ë¯¼ K í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "VitB1": {
                name: "VitB1",
                fullName: "VitB1 (Thiamine)",
                expression: "VitB1 = ì‚¬ë£Œ í‹°ì•„ë¯¼ í•¨ëŸ‰",
                description: "í‹°ì•„ë¯¼ = ì‚¬ë£Œ í‹°ì•„ë¯¼ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "VitB2": {
                name: "VitB2",
                fullName: "VitB2 (Riboflavin)",
                expression: "VitB2 = ì‚¬ë£Œ ë¦¬ë³´í”Œë¼ë¹ˆ í•¨ëŸ‰",
                description: "ë¦¬ë³´í”Œë¼ë¹ˆ = ì‚¬ë£Œ ë¦¬ë³´í”Œë¼ë¹ˆ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "VitB6": {
                name: "VitB6",
                fullName: "VitB6 (Pyridoxine)",
                expression: "VitB6 = ì‚¬ë£Œ í”¼ë¦¬ë…ì‹  í•¨ëŸ‰",
                description: "í”¼ë¦¬ë…ì‹  = ì‚¬ë£Œ í”¼ë¦¬ë…ì‹  í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "VitB12": {
                name: "VitB12",
                fullName: "VitB12 (Cobalamin)",
                expression: "VitB12 = ì‚¬ë£Œ ì½”ë°œë¼ë¯¼ í•¨ëŸ‰",
                description: "ì½”ë°œë¼ë¯¼ = ì‚¬ë£Œ ì½”ë°œë¼ë¯¼ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "Niacin": {
                name: "Niacin",
                fullName: "Niacin (Nicotinic Acid)",
                expression: "Niacin = ì‚¬ë£Œ ë‚˜ì´ì•„ì‹  í•¨ëŸ‰",
                description: "ë‚˜ì´ì•„ì‹  = ì‚¬ë£Œ ë‚˜ì´ì•„ì‹  í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "Pantothenic": {
                name: "Pantothenic",
                fullName: "Pantothenic Acid",
                expression: "Pantothenic = ì‚¬ë£Œ íŒí† í…ì‚° í•¨ëŸ‰",
                description: "íŒí† í…ì‚° = ì‚¬ë£Œ íŒí† í…ì‚° í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "Biotin": {
                name: "Biotin",
                fullName: "Biotin",
                expression: "Biotin = ì‚¬ë£Œ ë¹„ì˜¤í‹´ í•¨ëŸ‰",
                description: "ë¹„ì˜¤í‹´ = ì‚¬ë£Œ ë¹„ì˜¤í‹´ í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "Folic": {
                name: "Folic",
                fullName: "Folic Acid",
                expression: "Folic = ì‚¬ë£Œ ì—½ì‚° í•¨ëŸ‰",
                description: "ì—½ì‚° = ì‚¬ë£Œ ì—½ì‚° í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },
            "Choline": {
                name: "Choline",
                fullName: "Choline",
                expression: "Choline = ì‚¬ë£Œ ì½œë¦° í•¨ëŸ‰",
                description: "ì½œë¦° = ì‚¬ë£Œ ì½œë¦° í•¨ëŸ‰",
                level: 0,
                dependencies: [],
                category: "vitamin",
                location: "rumen"
            },

            // === ì†Œì¥ ëª¨ë¸ë“¤ ===
            // ì†Œì¥ ë‹¨ë°±ì§ˆ
            "SI_Protein": {
                name: "SI_Protein",
                fullName: "SI_Protein (Small Intestine Protein)",
                expression: "SI_Protein = MP x SI_Protein_íš¨ìœ¨ì„±",
                description: "ì†Œì¥ ë‹¨ë°±ì§ˆ = ëŒ€ì‚¬ì„± ë‹¨ë°±ì§ˆ x ì†Œì¥ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["MP", "SI_Protein_íš¨ìœ¨ì„±"],
                category: "protein",
                location: "small-intestine"
            },
            "SI_Protein_íš¨ìœ¨ì„±": {
                name: "SI_Protein_íš¨ìœ¨ì„±",
                fullName: "SI_Protein_íš¨ìœ¨ì„± (SI Protein Efficiency)",
                expression: "SI_Protein_íš¨ìœ¨ì„± = 0.85",
                description: "ì†Œì¥ ë‹¨ë°±ì§ˆ íš¨ìœ¨ì„± = 85%",
                level: 1,
                dependencies: [],
                category: "protein",
                location: "small-intestine"
            },

            // ì†Œì¥ ì—ë„ˆì§€
            "SI_Energy": {
                name: "SI_Energy",
                fullName: "SI_Energy (Small Intestine Energy)",
                expression: "SI_Energy = ME x SI_Energy_íš¨ìœ¨ì„±",
                description: "ì†Œì¥ ì—ë„ˆì§€ = ëŒ€ì‚¬ì„± ì—ë„ˆì§€ x ì†Œì¥ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["ME", "SI_Energy_íš¨ìœ¨ì„±"],
                category: "energy",
                location: "small-intestine"
            },
            "SI_Energy_íš¨ìœ¨ì„±": {
                name: "SI_Energy_íš¨ìœ¨ì„±",
                fullName: "SI_Energy_íš¨ìœ¨ì„± (SI Energy Efficiency)",
                expression: "SI_Energy_íš¨ìœ¨ì„± = 0.90",
                description: "ì†Œì¥ ì—ë„ˆì§€ íš¨ìœ¨ì„± = 90%",
                level: 1,
                dependencies: [],
                category: "energy",
                location: "small-intestine"
            },

            // ì†Œì¥ íƒ„ìˆ˜í™”ë¬¼
            "SI_Carbohydrate": {
                name: "SI_Carbohydrate",
                fullName: "SI_Carbohydrate (Small Intestine Carbohydrate)",
                expression: "SI_Carbohydrate = CHO x SI_Carb_íš¨ìœ¨ì„±",
                description: "ì†Œì¥ íƒ„ìˆ˜í™”ë¬¼ = íƒ„ìˆ˜í™”ë¬¼ x ì†Œì¥ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["CHO", "SI_Carb_íš¨ìœ¨ì„±"],
                category: "carbohydrate",
                location: "small-intestine"
            },
            "SI_Carb_íš¨ìœ¨ì„±": {
                name: "SI_Carb_íš¨ìœ¨ì„±",
                fullName: "SI_Carb_íš¨ìœ¨ì„± (SI Carbohydrate Efficiency)",
                expression: "SI_Carb_íš¨ìœ¨ì„± = 0.95",
                description: "ì†Œì¥ íƒ„ìˆ˜í™”ë¬¼ íš¨ìœ¨ì„± = 95%",
                level: 1,
                dependencies: [],
                category: "carbohydrate",
                location: "small-intestine"
            },

            // ì†Œì¥ ì§€ë°©
            "SI_Fat": {
                name: "SI_Fat",
                fullName: "SI_Fat (Small Intestine Fat)",
                expression: "SI_Fat = Fat x SI_Fat_íš¨ìœ¨ì„±",
                description: "ì†Œì¥ ì§€ë°© = ì§€ë°© x ì†Œì¥ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["Fat", "SI_Fat_íš¨ìœ¨ì„±"],
                category: "fat",
                location: "small-intestine"
            },
            "SI_Fat_íš¨ìœ¨ì„±": {
                name: "SI_Fat_íš¨ìœ¨ì„±",
                fullName: "SI_Fat_íš¨ìœ¨ì„± (SI Fat Efficiency)",
                expression: "SI_Fat_íš¨ìœ¨ì„± = 0.88",
                description: "ì†Œì¥ ì§€ë°© íš¨ìœ¨ì„± = 88%",
                level: 1,
                dependencies: [],
                category: "fat",
                location: "small-intestine"
            },

            // ì†Œì¥ ë¯¸ë„¤ë„
            "SI_Ca": {
                name: "SI_Ca",
                fullName: "SI_Ca (Small Intestine Calcium)",
                expression: "SI_Ca = Ca x SI_Ca_íš¨ìœ¨ì„±",
                description: "ì†Œì¥ ì¹¼ìŠ˜ = ì¹¼ìŠ˜ x ì†Œì¥ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["Ca", "SI_Ca_íš¨ìœ¨ì„±"],
                category: "mineral",
                location: "small-intestine"
            },
            "SI_Ca_íš¨ìœ¨ì„±": {
                name: "SI_Ca_íš¨ìœ¨ì„±",
                fullName: "SI_Ca_íš¨ìœ¨ì„± (SI Calcium Efficiency)",
                expression: "SI_Ca_íš¨ìœ¨ì„± = 0.45",
                description: "ì†Œì¥ ì¹¼ìŠ˜ íš¨ìœ¨ì„± = 45%",
                level: 1,
                dependencies: [],
                category: "mineral",
                location: "small-intestine"
            },
            "SI_P": {
                name: "SI_P",
                fullName: "SI_P (Small Intestine Phosphorus)",
                expression: "SI_P = P x SI_P_íš¨ìœ¨ì„±",
                description: "ì†Œì¥ ì¸ = ì¸ x ì†Œì¥ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["P", "SI_P_íš¨ìœ¨ì„±"],
                category: "mineral",
                location: "small-intestine"
            },
            "SI_P_íš¨ìœ¨ì„±": {
                name: "SI_P_íš¨ìœ¨ì„±",
                fullName: "SI_P_íš¨ìœ¨ì„± (SI Phosphorus Efficiency)",
                expression: "SI_P_íš¨ìœ¨ì„± = 0.65",
                description: "ì†Œì¥ ì¸ íš¨ìœ¨ì„± = 65%",
                level: 1,
                dependencies: [],
                category: "mineral",
                location: "small-intestine"
            },

            // ì†Œì¥ ë¹„íƒ€ë¯¼
            "SI_VitA": {
                name: "SI_VitA",
                fullName: "SI_VitA (Small Intestine Vitamin A)",
                expression: "SI_VitA = VitA x SI_VitA_íš¨ìœ¨ì„±",
                description: "ì†Œì¥ ë¹„íƒ€ë¯¼ A = ë¹„íƒ€ë¯¼ A x ì†Œì¥ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["VitA", "SI_VitA_íš¨ìœ¨ì„±"],
                category: "vitamin",
                location: "small-intestine"
            },
            "SI_VitA_íš¨ìœ¨ì„±": {
                name: "SI_VitA_íš¨ìœ¨ì„±",
                fullName: "SI_VitA_íš¨ìœ¨ì„± (SI Vitamin A Efficiency)",
                expression: "SI_VitA_íš¨ìœ¨ì„± = 0.75",
                description: "ì†Œì¥ ë¹„íƒ€ë¯¼ A íš¨ìœ¨ì„± = 75%",
                level: 1,
                dependencies: [],
                category: "vitamin",
                location: "small-intestine"
            },

            // === ëŒ€ì¥ ëª¨ë¸ë“¤ ===
            // ëŒ€ì¥ ë‹¨ë°±ì§ˆ
            "LI_Protein": {
                name: "LI_Protein",
                fullName: "LI_Protein (Large Intestine Protein)",
                expression: "LI_Protein = SI_Protein x LI_Protein_íš¨ìœ¨ì„±",
                description: "ëŒ€ì¥ ë‹¨ë°±ì§ˆ = ì†Œì¥ ë‹¨ë°±ì§ˆ x ëŒ€ì¥ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["SI_Protein", "LI_Protein_íš¨ìœ¨ì„±"],
                category: "protein",
                location: "large-intestine"
            },
            "LI_Protein_íš¨ìœ¨ì„±": {
                name: "LI_Protein_íš¨ìœ¨ì„±",
                fullName: "LI_Protein_íš¨ìœ¨ì„± (LI Protein Efficiency)",
                expression: "LI_Protein_íš¨ìœ¨ì„± = 0.15",
                description: "ëŒ€ì¥ ë‹¨ë°±ì§ˆ íš¨ìœ¨ì„± = 15%",
                level: 1,
                dependencies: [],
                category: "protein",
                location: "large-intestine"
            },

            // ëŒ€ì¥ ì—ë„ˆì§€
            "LI_Energy": {
                name: "LI_Energy",
                fullName: "LI_Energy (Large Intestine Energy)",
                expression: "LI_Energy = SI_Energy x LI_Energy_íš¨ìœ¨ì„±",
                description: "ëŒ€ì¥ ì—ë„ˆì§€ = ì†Œì¥ ì—ë„ˆì§€ x ëŒ€ì¥ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["SI_Energy", "LI_Energy_íš¨ìœ¨ì„±"],
                category: "energy",
                location: "large-intestine"
            },
            "LI_Energy_íš¨ìœ¨ì„±": {
                name: "LI_Energy_íš¨ìœ¨ì„±",
                fullName: "LI_Energy_íš¨ìœ¨ì„± (LI Energy Efficiency)",
                expression: "LI_Energy_íš¨ìœ¨ì„± = 0.10",
                description: "ëŒ€ì¥ ì—ë„ˆì§€ íš¨ìœ¨ì„± = 10%",
                level: 1,
                dependencies: [],
                category: "energy",
                location: "large-intestine"
            },

            // === ê°„ ëª¨ë¸ë“¤ ===
            // ê°„ ë‹¨ë°±ì§ˆ
            "Liver_Protein": {
                name: "Liver_Protein",
                fullName: "Liver_Protein (Liver Protein)",
                expression: "Liver_Protein = SI_Protein x Liver_Protein_íš¨ìœ¨ì„±",
                description: "ê°„ ë‹¨ë°±ì§ˆ = ì†Œì¥ ë‹¨ë°±ì§ˆ x ê°„ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["SI_Protein", "Liver_Protein_íš¨ìœ¨ì„±"],
                category: "protein",
                location: "liver"
            },
            "Liver_Protein_íš¨ìœ¨ì„±": {
                name: "Liver_Protein_íš¨ìœ¨ì„±",
                fullName: "Liver_Protein_íš¨ìœ¨ì„± (Liver Protein Efficiency)",
                expression: "Liver_Protein_íš¨ìœ¨ì„± = 0.95",
                description: "ê°„ ë‹¨ë°±ì§ˆ íš¨ìœ¨ì„± = 95%",
                level: 1,
                dependencies: [],
                category: "protein",
                location: "liver"
            },

            // ê°„ ì—ë„ˆì§€
            "Liver_Energy": {
                name: "Liver_Energy",
                fullName: "Liver_Energy (Liver Energy)",
                expression: "Liver_Energy = SI_Energy x Liver_Energy_íš¨ìœ¨ì„±",
                description: "ê°„ ì—ë„ˆì§€ = ì†Œì¥ ì—ë„ˆì§€ x ê°„ íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["SI_Energy", "Liver_Energy_íš¨ìœ¨ì„±"],
                category: "energy",
                location: "liver"
            },
            "Liver_Energy_íš¨ìœ¨ì„±": {
                name: "Liver_Energy_íš¨ìœ¨ì„±",
                fullName: "Liver_Energy_íš¨ìœ¨ì„± (Liver Energy Efficiency)",
                expression: "Liver_Energy_íš¨ìœ¨ì„± = 0.98",
                description: "ê°„ ì—ë„ˆì§€ íš¨ìœ¨ì„± = 98%",
                level: 1,
                dependencies: [],
                category: "energy",
                location: "liver"
            },

            // === ì „ì‹  ëª¨ë¸ë“¤ ===
            // ì „ì‹  ë‹¨ë°±ì§ˆ
            "Systemic_Protein": {
                name: "Systemic_Protein",
                fullName: "Systemic_Protein (Systemic Protein)",
                expression: "Systemic_Protein = Liver_Protein x Systemic_Protein_íš¨ìœ¨ì„±",
                description: "ì „ì‹  ë‹¨ë°±ì§ˆ = ê°„ ë‹¨ë°±ì§ˆ x ì „ì‹  íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["Liver_Protein", "Systemic_Protein_íš¨ìœ¨ì„±"],
                category: "protein",
                location: "systemic"
            },
            "Systemic_Protein_íš¨ìœ¨ì„±": {
                name: "Systemic_Protein_íš¨ìœ¨ì„±",
                fullName: "Systemic_Protein_íš¨ìœ¨ì„± (Systemic Protein Efficiency)",
                expression: "Systemic_Protein_íš¨ìœ¨ì„± = 0.99",
                description: "ì „ì‹  ë‹¨ë°±ì§ˆ íš¨ìœ¨ì„± = 99%",
                level: 1,
                dependencies: [],
                category: "protein",
                location: "systemic"
            },

            // ì „ì‹  ì—ë„ˆì§€
            "Systemic_Energy": {
                name: "Systemic_Energy",
                fullName: "Systemic_Energy (Systemic Energy)",
                expression: "Systemic_Energy = Liver_Energy x Systemic_Energy_íš¨ìœ¨ì„±",
                description: "ì „ì‹  ì—ë„ˆì§€ = ê°„ ì—ë„ˆì§€ x ì „ì‹  íš¨ìœ¨ì„±",
                level: 0,
                dependencies: ["Liver_Energy", "Systemic_Energy_íš¨ìœ¨ì„±"],
                category: "energy",
                location: "systemic"
            },
            "Systemic_Energy_íš¨ìœ¨ì„±": {
                name: "Systemic_Energy_íš¨ìœ¨ì„±",
                fullName: "Systemic_Energy_íš¨ìœ¨ì„± (Systemic Energy Efficiency)",
                expression: "Systemic_Energy_íš¨ìœ¨ì„± = 0.99",
                description: "ì „ì‹  ì—ë„ˆì§€ íš¨ìœ¨ì„± = 99%",
                level: 1,
                dependencies: [],
                category: "energy",
                location: "systemic"
            },

            // === ì„­ì·¨ëŸ‰ ëª¨ë¸ ===
            "DMI": {
                name: "DMI",
                fullName: "DMI (Dry Matter Intake)",
                expression: "DMI = ê¸°ë³¸ ì„­ì·¨ëŸ‰ x ì¡°ì • ê³„ìˆ˜ë“¤",
                description: "ê±´ë¬¼ ì„­ì·¨ëŸ‰ = ê¸°ë³¸ ì„­ì·¨ëŸ‰ x ì¡°ì • ê³„ìˆ˜ë“¤",
                level: 0,
                dependencies: ["ê¸°ë³¸ ì„­ì·¨ëŸ‰", "ì¡°ì • ê³„ìˆ˜ë“¤"],
                category: "intake",
                location: "rumen"
            },
            "ê¸°ë³¸ ì„­ì·¨ëŸ‰": {
                name: "ê¸°ë³¸ ì„­ì·¨ëŸ‰",
                fullName: "ê¸°ë³¸ ì„­ì·¨ëŸ‰ (Base Intake)",
                expression: "ê¸°ë³¸ ì„­ì·¨ëŸ‰ = ì²´ì¤‘ x 0.025",
                description: "ê¸°ë³¸ ì„­ì·¨ëŸ‰ = ì²´ì¤‘ x 2.5%",
                level: 1,
                dependencies: ["ì²´ì¤‘"],
                category: "intake",
                location: "rumen"
            },
            "ì¡°ì • ê³„ìˆ˜ë“¤": {
                name: "ì¡°ì • ê³„ìˆ˜ë“¤",
                fullName: "ì¡°ì • ê³„ìˆ˜ë“¤ (Adjustment Factors)",
                expression: "ì¡°ì • ê³„ìˆ˜ë“¤ = ì˜¨ë„ì¡°ì • x ìŠµë„ì¡°ì • x ì„ì‹ ì¡°ì •",
                description: "ì¡°ì • ê³„ìˆ˜ë“¤ = ì˜¨ë„ x ìŠµë„ x ì„ì‹  ì¡°ì •",
                level: 1,
                dependencies: ["ì˜¨ë„ì¡°ì •", "ìŠµë„ì¡°ì •", "ì„ì‹ ì¡°ì •"],
                category: "intake",
                location: "rumen"
            },
            "ì²´ì¤‘": {
                name: "ì²´ì¤‘",
                fullName: "ì²´ì¤‘ (Body Weight)",
                expression: "ì²´ì¤‘ = ì…ë ¥ê°’",
                description: "ì²´ì¤‘ = ì‚¬ìš©ì ì…ë ¥ê°’",
                level: 2,
                dependencies: [],
                category: "intake",
                location: "rumen"
            },
            "ì˜¨ë„ì¡°ì •": {
                name: "ì˜¨ë„ì¡°ì •",
                fullName: "ì˜¨ë„ì¡°ì • (Temperature Adjustment)",
                expression: "ì˜¨ë„ì¡°ì • = 1.0433 - 0.0044 x ì˜¨ë„ + 0.0001 x ì˜¨ë„Â²",
                description: "ì˜¨ë„ì¡°ì • = ì˜¨ë„ì— ë”°ë¥¸ ì¡°ì • ê³„ìˆ˜",
                level: 2,
                dependencies: ["ì˜¨ë„"],
                category: "intake",
                location: "rumen"
            },
            "ìŠµë„ì¡°ì •": {
                name: "ìŠµë„ì¡°ì •",
                fullName: "ìŠµë„ì¡°ì • (Humidity Adjustment)",
                expression: "ìŠµë„ì¡°ì • = 1 - 0.01 x ìŠµë„",
                description: "ìŠµë„ì¡°ì • = ìŠµë„ì— ë”°ë¥¸ ì¡°ì • ê³„ìˆ˜",
                level: 2,
                dependencies: ["ìŠµë„"],
                category: "intake",
                location: "rumen"
            },
            "ì„ì‹ ì¡°ì •": {
                name: "ì„ì‹ ì¡°ì •",
                fullName: "ì„ì‹ ì¡°ì • (Pregnancy Adjustment)",
                expression: "ì„ì‹ ì¡°ì • = if(ì„ì‹ ì¼ >= 260, 0.8, 1)",
                description: "ì„ì‹ ì¡°ì • = ì„ì‹ ì¼ìˆ˜ì— ë”°ë¥¸ ì¡°ì • ê³„ìˆ˜",
                level: 2,
                dependencies: ["ì„ì‹ ì¼"],
                category: "intake",
                location: "rumen"
            },
            "ì˜¨ë„": {
                name: "ì˜¨ë„",
                fullName: "ì˜¨ë„ (Temperature)",
                expression: "ì˜¨ë„ = ì…ë ¥ê°’",
                description: "ì˜¨ë„ = ì‚¬ìš©ì ì…ë ¥ê°’",
                level: 3,
                dependencies: [],
                category: "intake",
                location: "rumen"
            },
            "ìŠµë„": {
                name: "ìŠµë„",
                fullName: "ìŠµë„ (Humidity)",
                expression: "ìŠµë„ = ì…ë ¥ê°’",
                description: "ìŠµë„ = ì‚¬ìš©ì ì…ë ¥ê°’",
                level: 3,
                dependencies: [],
                category: "intake",
                location: "rumen"
            },
            "ì„ì‹ ì¼": {
                name: "ì„ì‹ ì¼",
                fullName: "ì„ì‹ ì¼ (Pregnancy Day)",
                expression: "ì„ì‹ ì¼ = ì…ë ¥ê°’",
                description: "ì„ì‹ ì¼ = ì‚¬ìš©ì ì…ë ¥ê°’",
                level: 3,
                dependencies: [],
                category: "intake",
                location: "rumen"
            }
        };

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            const totalFormulas = Object.keys(formulaDatabase).length;
            const implementedFormulas = totalFormulas;
            const progressPercentage = Math.round((implementedFormulas / totalFormulas) * 100);
            
            document.getElementById('totalFormulas').textContent = totalFormulas;
            document.getElementById('implementedFormulas').textContent = implementedFormulas;
            document.getElementById('progressPercentage').textContent = progressPercentage;
        }

        // ì¹´í…Œê³ ë¦¬ ì„ íƒ í•¨ìˆ˜
        function selectCategory(categoryLocation) {
            const [category, location] = categoryLocation.split('-');
            const treeContainer = document.getElementById('formula-tree');
            
            if (!treeContainer) return;
            
            clearTree();
            
            // ì¹´í…Œê³ ë¦¬ë³„ ì•„ì´ì½˜ê³¼ ì œëª©
            const categoryIcons = {
                'protein': 'ğŸ¥©',
                'energy': 'âš¡',
                'carbohydrate': 'ğŸŒ¾',
                'fat': 'ğŸ«˜',
                'mineral': 'ğŸª¨',
                'vitamin': 'ğŸ’Š'
            };
            
            const locationNames = {
                'rumen': 'ë°˜ì¶”ìœ„',
                'small-intestine': 'ì†Œì¥',
                'large-intestine': 'ëŒ€ì¥',
                'liver': 'ê°„',
                'systemic': 'ì „ì‹ '
            };
            
            const icon = categoryIcons[category] || 'ğŸ“Š';
            const locationName = locationNames[location] || location;
            
            treeContainer.innerHTML = `<h3>${icon} ${locationName} ${category} ê³„ì‚°ì‹</h3>`;
            
            // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì™€ ìœ„ì¹˜ì˜ Level 0 ìˆ˜ì‹ë“¤ë§Œ í•„í„°ë§
            const level0Formulas = Object.values(formulaDatabase).filter(formula => 
                formula.category === category && formula.location === location && formula.level === 0
            );
            
            if (level0Formulas.length === 0) {
                treeContainer.innerHTML += '<p>í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ Level 0 ìˆ˜ì‹ì´ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // Level 0 ìˆ˜ì‹ë“¤ì„ í•œ ì¤„ì— í‘œì‹œ
            level0Formulas.forEach(formula => {
                const formulaDiv = document.createElement('div');
                formulaDiv.className = 'formula-expression';
                formulaDiv.style.display = 'inline-block';
                formulaDiv.style.marginRight = '20px';
                formulaDiv.style.marginBottom = '10px';
                formulaDiv.style.minWidth = '300px';
                formulaDiv.style.fontSize = '12px';
                formulaDiv.style.padding = '10px';
                
                const categoryBadge = `<span class="category-badge category-${formula.category}">${formula.category}</span>`;
                
                formulaDiv.innerHTML = `
                    <strong>${formula.name}</strong>${categoryBadge}: ${formula.expression}
                    <br><em style="font-size: 11px;">${formula.description}</em>
                `;
                
                // ì˜ì¡´ì„± ë²„íŠ¼ë“¤ ìƒì„±
                if (formula.dependencies && formula.dependencies.length > 0) {
                    const buttonsContainer = document.createElement('div');
                    buttonsContainer.className = 'dependency-buttons';
                    buttonsContainer.style.marginTop = '10px';
                    
                    formula.dependencies.forEach(depName => {
                        const depFormula = formulaDatabase[depName];
                        if (depFormula) {
                            const button = document.createElement('button');
                            button.className = 'formula-button';
                            button.style.fontSize = '11px';
                            button.style.padding = '6px 12px';
                            button.textContent = depName;
                            button.onclick = () => expandFormula(depName, 1);
                            buttonsContainer.appendChild(button);
                        } else {
                            const leafNode = document.createElement('span');
                            leafNode.className = 'tree-node leaf';
                            leafNode.style.fontSize = '11px';
                            leafNode.textContent = depName + ' (ì…ë ¥ê°’)';
                            buttonsContainer.appendChild(leafNode);
                        }
                    });
                    
                    formulaDiv.appendChild(buttonsContainer);
                } else {
                    const leafDiv = document.createElement('div');
                    leafDiv.innerHTML = '<span class="tree-node leaf" style="font-size: 11px;">ğŸƒ ì ë…¸ë“œ (ìµœì¢… ì…ë ¥ê°’)</span>';
                    formulaDiv.appendChild(leafDiv);
                }
                
                treeContainer.appendChild(formulaDiv);
            });
        }

        // ìˆ˜ì‹ í™•ì¥ í•¨ìˆ˜ - ê°œì„ ëœ ê³„ì¸µ êµ¬ì¡°
        function expandFormula(formulaName, level) {
            const formula = formulaDatabase[formulaName];
            if (!formula) return;
            
            const treeContainer = document.getElementById('formula-tree');
            if (!treeContainer) return;
            
            // ê¸°ì¡´ Level ì œê±° (ê°™ì€ ë ˆë²¨ì˜ ë‹¤ë¥¸ ìˆ˜ì‹ë“¤ì€ ìœ ì§€)
            const existingLevel = document.getElementById('level-' + level + '-' + formulaName);
            if (existingLevel) {
                existingLevel.remove();
            }
            
            // ìƒˆ Level ì»¨í…Œì´ë„ˆ ìƒì„±
            const levelContainer = document.createElement('div');
            levelContainer.id = 'level-' + level + '-' + formulaName;
            levelContainer.className = 'level-container';
            levelContainer.style.display = 'inline-block';
            levelContainer.style.verticalAlign = 'top';
            levelContainer.style.marginRight = '20px';
            levelContainer.style.marginBottom = '10px';
            levelContainer.style.minWidth = '300px';
            
            const levelIcons = ['ğŸŒ±', 'ğŸŒ¿', 'ğŸŒ³', 'ğŸŒ²', 'ğŸŒ´', 'ğŸŒµ', 'ğŸƒ'];
            const icon = levelIcons[Math.min(level, levelIcons.length - 1)];
            const categoryBadge = `<span class="category-badge category-${formula.category}">${formula.category}</span>`;
            
            levelContainer.innerHTML = `<h3 style="font-size: 14px; margin-bottom: 10px;">${icon} Level ${level}: ${formula.name}${categoryBadge}</h3>`;
            
            // ìˆ˜ì‹ í‘œì‹œ
            const expressionDiv = document.createElement('div');
            expressionDiv.className = 'formula-expression';
            expressionDiv.style.fontSize = '12px';
            expressionDiv.style.padding = '10px';
            expressionDiv.innerHTML = `<strong>${formula.expression}</strong><br><em style="font-size: 11px;">${formula.description}</em>`;
            levelContainer.appendChild(expressionDiv);
            
            // ì˜ì¡´ì„± ë²„íŠ¼ë“¤ ìƒì„±
            if (formula.dependencies && formula.dependencies.length > 0) {
                const buttonsContainer = document.createElement('div');
                buttonsContainer.className = 'dependency-buttons';
                buttonsContainer.style.marginTop = '10px';
                
                formula.dependencies.forEach(depName => {
                    const depFormula = formulaDatabase[depName];
                    if (depFormula) {
                        const button = document.createElement('button');
                        button.className = 'formula-button';
                        button.style.fontSize = '11px';
                        button.style.padding = '6px 12px';
                        button.textContent = depName;
                        button.onclick = () => expandFormula(depName, level + 1);
                        buttonsContainer.appendChild(button);
                    } else {
                        const leafNode = document.createElement('span');
                        leafNode.className = 'tree-node leaf';
                        leafNode.style.fontSize = '11px';
                        leafNode.textContent = depName + ' (ì…ë ¥ê°’)';
                        buttonsContainer.appendChild(leafNode);
                    }
                });
                
                levelContainer.appendChild(buttonsContainer);
            } else {
                const leafDiv = document.createElement('div');
                leafDiv.innerHTML = '<span class="tree-node leaf" style="font-size: 11px;">ğŸƒ ì ë…¸ë“œ (ìµœì¢… ì…ë ¥ê°’)</span>';
                levelContainer.appendChild(leafDiv);
            }
            
            // ê°™ì€ ë ˆë²¨ì˜ ì»¨í…Œì´ë„ˆê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì¶”ê°€
            const levelRow = document.getElementById('level-row-' + level);
            if (levelRow) {
                levelRow.appendChild(levelContainer);
            } else {
                // ìƒˆë¡œìš´ ë ˆë²¨ í–‰ ìƒì„±
                const levelRowDiv = document.createElement('div');
                levelRowDiv.id = 'level-row-' + level;
                levelRowDiv.className = 'level-row';
                levelRowDiv.style.marginBottom = '20px';
                levelRowDiv.style.border = '2px solid #e0e0e0';
                levelRowDiv.style.borderRadius = '8px';
                levelRowDiv.style.padding = '15px';
                levelRowDiv.style.backgroundColor = '#f8f9fa';
                
                const levelHeader = document.createElement('h2');
                levelHeader.style.margin = '0 0 15px 0';
                levelHeader.style.fontSize = '18px';
                levelHeader.style.color = '#333';
                levelHeader.textContent = `ğŸŒ¿ Level ${level} ìˆ˜ì‹ë“¤`;
                levelRowDiv.appendChild(levelHeader);
                
                levelRowDiv.appendChild(levelContainer);
                treeContainer.appendChild(levelRowDiv);
            }
        }

        // ìˆ˜ì‹ í‘œí˜„ì‹ì—ì„œ ë³€ìˆ˜ ì¶”ì¶œ
        function extractVariablesFromExpression(expression) {
            // ìˆ˜í•™ ì—°ì‚°ìì™€ íŠ¹ìˆ˜ë¬¸ì ì œê±°í•˜ê³  ë³€ìˆ˜ë§Œ ì¶”ì¶œ
            const variables = expression
                .replace(/[+\-*/=()Â²]/g, ' ')
                .split(/\s+/)
                .filter(v => {
                    const trimmed = v.trim();
                    return trimmed && 
                           !isNaN(trimmed) === false && 
                           trimmed.length > 0 && 
                           !trimmed.includes('x') && // ê³±í•˜ê¸° ê¸°í˜¸ ì œì™¸
                           !trimmed.includes('Ã—'); // ê³±í•˜ê¸° ê¸°í˜¸ ì œì™¸
                });
            
            return [...new Set(variables)]; // ì¤‘ë³µ ì œê±°
        }

        // ì „ì²´ ìˆ˜ì‹ ë³´ê¸°
        function showAllFormulas() {
            const treeContainer = document.getElementById('formula-tree');
            if (!treeContainer) return;
            
            clearTree();
            treeContainer.innerHTML = '<h3>ğŸ“‹ ì „ì²´ ìˆ˜ì‹ ëª©ë¡ (ì˜ì–‘ì†Œë³„ Ã— ì¥ì†Œë³„ ë¶„ë¥˜)</h3>';
            
            // ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”
            const categories = {};
            Object.values(formulaDatabase).forEach(formula => {
                if (!categories[formula.category]) {
                    categories[formula.category] = {};
                }
                if (!categories[formula.category][formula.location]) {
                    categories[formula.category][formula.location] = [];
                }
                categories[formula.category][formula.location].push(formula);
            });
            
            Object.keys(categories).forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'level-container';
                
                const categoryIcons = {
                    'protein': 'ğŸ¥©',
                    'energy': 'âš¡',
                    'carbohydrate': 'ğŸŒ¾',
                    'fat': 'ğŸ«˜',
                    'mineral': 'ğŸª¨',
                    'vitamin': 'ğŸ’Š'
                };
                
                const icon = categoryIcons[category] || 'ğŸ“Š';
                categoryDiv.innerHTML = `<h3>${icon} ${category.toUpperCase()} (${Object.values(categories[category]).flat().length}ê°œ)</h3>`;
                
                Object.keys(categories[category]).forEach(location => {
                    const locationDiv = document.createElement('div');
                    locationDiv.style.marginBottom = '20px';
                    locationDiv.innerHTML = `<h4>ğŸ“ ${location} (${categories[category][location].length}ê°œ)</h4>`;
                    
                    categories[category][location].forEach(formula => {
                        const formulaDiv = document.createElement('div');
                        formulaDiv.className = 'formula-expression';
                        formulaDiv.innerHTML = `<strong>${formula.name}</strong>: ${formula.expression}<br><em>${formula.description}</em>`;
                        locationDiv.appendChild(formulaDiv);
                    });
                    
                    categoryDiv.appendChild(locationDiv);
                });
                
                treeContainer.appendChild(categoryDiv);
            });
        }

        // íŠ¸ë¦¬ ì´ˆê¸°í™”
        function clearTree() {
            const treeContainer = document.getElementById('formula-tree');
            if (treeContainer) {
                treeContainer.innerHTML = '<p>íŠ¸ë¦¬ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>';
            }
            
            // ëª¨ë“  ë ˆë²¨ í–‰ ì œê±°
            const levelRows = document.querySelectorAll('.level-row');
            levelRows.forEach(row => row.remove());
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            initializeDiagram();
        });

        // D3.js ë‹¤ì´ì–´ê·¸ë¨ ê´€ë ¨ ë³€ìˆ˜ë“¤
        let simulation;
        let svg;
        let tooltip;
        let currentData = { nodes: [], links: [] };

        // ë‹¤ì´ì–´ê·¸ë¨ ì´ˆê¸°í™”
        function initializeDiagram() {
            try {
                const container = document.getElementById('network-diagram');
                if (!container) {
                    console.error('network-diagram ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // ê¸°ì¡´ SVG ì œê±°
                container.innerHTML = '';

                // SVG ìƒì„±
                svg = d3.select('#network-diagram')
                    .append('svg')
                    .attr('width', '100%')
                    .attr('height', '100%')
                    .attr('viewBox', '0 0 800 600');

                // ì¤Œ ê¸°ëŠ¥ ì¶”ê°€
                const zoom = d3.zoom()
                    .scaleExtent([0.1, 4])
                    .on('zoom', (event) => {
                        svg.select('g').attr('transform', event.transform);
                    });

                svg.call(zoom);

                // ë©”ì¸ ê·¸ë£¹ ìƒì„±
                svg.append('g');

                // íˆ´íŒ ìƒì„±
                tooltip = d3.select('body')
                    .append('div')
                    .attr('class', 'tooltip')
                    .style('opacity', 0);

                console.log('ë‹¤ì´ì–´ê·¸ë¨ ì´ˆê¸°í™” ì™„ë£Œ');
                
                // ì´ˆê¸° ë‹¤ì´ì–´ê·¸ë¨ í‘œì‹œ
                setTimeout(() => {
                    showTopLevel();
                }, 100);
                
            } catch (error) {
                console.error('ë‹¤ì´ì–´ê·¸ë¨ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                const container = document.getElementById('network-diagram');
                if (container) {
                    container.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">ë‹¤ì´ì–´ê·¸ë¨ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                }
            }
        }

        // ë°ì´í„°ë¥¼ D3.js ê²°ì •ë‚˜ë¬´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        function prepareDiagramData(formulas, selectedFormulas = null) {
            const nodes = [];
            const links = [];
            const nodeMap = new Map();

            // ë…¸ë“œ ìƒì„±
            Object.values(formulas).forEach(formula => {
                if (selectedFormulas && !selectedFormulas.includes(formula.name)) return;
                
                const node = {
                    id: formula.name,
                    name: formula.name,
                    fullName: formula.fullName,
                    expression: formula.expression,
                    description: formula.description,
                    category: formula.category,
                    location: formula.location,
                    level: formula.level,
                    isInput: formula.dependencies.length === 0
                };
                
                nodes.push(node);
                nodeMap.set(formula.name, node);
            });

            // ë§í¬ ìƒì„± - ë¶€ëª¨ì—ì„œ ìì‹ìœ¼ë¡œ (ê²°ê³¼ê°’ì—ì„œ ì…ë ¥ê°’ìœ¼ë¡œ)
            Object.values(formulas).forEach(formula => {
                if (selectedFormulas && !selectedFormulas.includes(formula.name)) return;
                
                // ìˆ˜ì‹ í‘œí˜„ì‹ì—ì„œ ë³€ìˆ˜ ì¶”ì¶œ
                const variables = extractVariablesFromExpression(formula.expression);
                
                variables.forEach(varName => {
                    if (nodeMap.has(varName)) {
                        links.push({
                            source: formula.name,  // ë¶€ëª¨ (ê²°ê³¼ê°’)
                            target: varName        // ìì‹ (ì…ë ¥ê°’)
                        });
                    }
                });
            });

            return { nodes, links };
        }

        // ë‹¤ì´ì–´ê·¸ë¨ ì—…ë°ì´íŠ¸ - ê²°ì •ë‚˜ë¬´ êµ¬ì¡°ë¡œ ë³€ê²½
        function updateDiagram(data) {
            try {
                currentData = data;
                const container = svg.select('g');
                
                // ê¸°ì¡´ ìš”ì†Œë“¤ ì œê±°
                container.selectAll('*').remove();

                if (!data.nodes || data.nodes.length === 0) {
                    container.append('text')
                        .attr('x', 400)
                        .attr('y', 300)
                        .attr('text-anchor', 'middle')
                        .style('font-size', '16px')
                        .style('fill', '#666')
                        .text('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }

                // ìƒ‰ìƒ ìŠ¤ì¼€ì¼
                const colorScale = d3.scaleOrdinal()
                    .domain(['protein', 'energy', 'carbohydrate', 'fat', 'mineral', 'vitamin', 'intake'])
                    .range(['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff']);

                // ê²°ì •ë‚˜ë¬´ ë ˆì´ì•„ì›ƒ ê³„ì‚°
                const treeLayout = d3.tree().size([700, 500]);
                const root = buildHierarchy(data.nodes, data.links);
                const treeData = treeLayout(root);

                // ë§í¬ ê·¸ë¦¬ê¸° (ë¶€ëª¨-ìì‹ ì—°ê²°ì„ )
                const link = container.append('g')
                    .selectAll('path')
                    .data(treeData.links())
                    .enter().append('path')
                    .attr('class', 'link')
                    .attr('d', d3.linkVertical()
                        .x(d => d.x)
                        .y(d => d.y))
                    .attr('stroke', '#999')
                    .attr('stroke-width', 2)
                    .attr('fill', 'none');

                // ë…¸ë“œ ê·¸ë¦¬ê¸° (ì‚¬ê°í˜• ë°•ìŠ¤)
                const node = container.append('g')
                    .selectAll('g')
                    .data(treeData.descendants())
                    .enter().append('g')
                    .attr('class', 'node')
                    .attr('transform', d => `translate(${d.x},${d.y})`);

                // ë…¸ë“œ ë°•ìŠ¤
                node.append('rect')
                    .attr('width', 120)
                    .attr('height', 40)
                    .attr('x', -60)
                    .attr('y', -20)
                    .attr('rx', 5)
                    .attr('fill', d => d.data.category ? colorScale(d.data.category) : '#ccc')
                    .attr('stroke', '#fff')
                    .attr('stroke-width', 2)
                    .on('mouseover', function(event, d) {
                        tooltip.transition()
                            .duration(200)
                            .style('opacity', .9);
                        tooltip.html(`
                            <strong>${d.data.fullName || d.data.name}</strong><br/>
                            ${d.data.expression || ''}<br/>
                            <em>${d.data.description || ''}</em><br/>
                            ì¹´í…Œê³ ë¦¬: ${d.data.category || 'N/A'}<br/>
                            ìœ„ì¹˜: ${d.data.location || 'N/A'}<br/>
                            ë ˆë²¨: ${d.data.level || 'N/A'}
                        `)
                            .style('left', (event.pageX + 10) + 'px')
                            .style('top', (event.pageY - 28) + 'px');
                    })
                    .on('mouseout', function() {
                        tooltip.transition()
                            .duration(500)
                            .style('opacity', 0);
                    });

                // ë…¸ë“œ ë¼ë²¨
                node.append('text')
                    .attr('class', 'node-label')
                    .attr('text-anchor', 'middle')
                    .attr('dy', '.35em')
                    .style('font-size', '10px')
                    .style('fill', '#333')
                    .style('font-weight', 'bold')
                    .text(d => d.data.name);

                // ìˆ˜ì‹ í‘œí˜„ì‹ í‘œì‹œ (ì‘ì€ í…ìŠ¤íŠ¸)
                node.append('text')
                    .attr('text-anchor', 'middle')
                    .attr('dy', '1.2em')
                    .style('font-size', '8px')
                    .style('fill', '#666')
                    .text(d => {
                        const expr = d.data.expression || '';
                        return expr.length > 20 ? 
                            expr.substring(0, 20) + '...' : 
                            expr;
                    });
            } catch (error) {
                console.error('ë‹¤ì´ì–´ê·¸ë¨ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                const container = svg.select('g');
                container.selectAll('*').remove();
                container.append('text')
                    .attr('x', 400)
                    .attr('y', 300)
                    .attr('text-anchor', 'middle')
                    .style('font-size', '16px')
                    .style('fill', '#666')
                    .text('ë‹¤ì´ì–´ê·¸ë¨ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
            }
        }

        // ê³„ì¸µ êµ¬ì¡° ë°ì´í„° ìƒì„±
        function buildHierarchy(nodes, links) {
            if (!nodes || nodes.length === 0) {
                return { id: 'root', name: 'Root', children: [] };
            }

            const nodeMap = new Map();
            nodes.forEach(node => {
                nodeMap.set(node.id, { ...node, children: [] });
            });

            // ë§í¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¶€ëª¨-ìì‹ ê´€ê³„ ì„¤ì •
            links.forEach(link => {
                const parent = nodeMap.get(link.source);
                const child = nodeMap.get(link.target);
                if (parent && child) {
                    parent.children.push(child);
                }
            });

            // ë£¨íŠ¸ ë…¸ë“œ ì°¾ê¸° (ë‹¤ë¥¸ ë…¸ë“œì˜ ìì‹ì´ ì•„ë‹Œ ë…¸ë“œë“¤)
            const childIds = new Set();
            links.forEach(link => {
                childIds.add(link.target);
            });

            const roots = Array.from(nodeMap.values()).filter(node => 
                !childIds.has(node.id)
            );

            // ë£¨íŠ¸ê°€ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ë…¸ë“œë¥¼ ë£¨íŠ¸ë¡œ ì„¤ì •
            if (roots.length === 0) {
                return nodeMap.get(nodes[0].id) || { id: 'root', name: 'Root', children: [] };
            }

            // ì—¬ëŸ¬ ë£¨íŠ¸ê°€ ìˆìœ¼ë©´ ê°€ìƒì˜ ë£¨íŠ¸ ë…¸ë“œ ìƒì„±
            if (roots.length > 1) {
                return {
                    id: 'virtual-root',
                    name: 'Root',
                    children: roots
                };
            }

            return roots[0];
        }

        // ì „ì²´ ë…¸ë“œ ë³´ê¸°
        function showAllNodes() {
            const data = prepareDiagramData(formulaDatabase);
            updateDiagram(data);
            updateActiveButton('showAllNodes');
        }

        // MP ì²´ì¸ë§Œ ë³´ê¸°
        function showMPChain() {
            const mpChain = ['MP', 'MPfeed', 'MPbact', 'DIGPB1', 'DIGPB2', 'DIGPB3', 'MCP', 
                           'ID_Protein_1', 'ID_Protein_2', 'ID_Protein_3', 'adjREPB1', 
                           'adjREPB2', 'adjREPB3', 'REPB1', 'REPB2', 'REPB3', 'RDPB1', 
                           'RDPB2', 'RDPB3', 'RDPEP', 'PeptidePass', 'prot.b1', 'prot.b2', 
                           'prot.b3', 'kp', 'rate.prot.b1', 'rate.prot.b2', 'rate.prot.b3', 
                           'PeptideUp', 'forage.p', 'kp_forage', 'conc.p', 'kp_conc'];
            const data = prepareDiagramData(formulaDatabase, mpChain);
            updateDiagram(data);
            updateActiveButton('showMPChain');
        }

        // ME ì²´ì¸ë§Œ ë³´ê¸°
        function showMEChain() {
            const meChain = ['ME', 'GE', 'FE', 'UE', 'CH4E', 'EE', 'CP', 'NDF', 'NFC', 
                           'ì†Œí™”ìœ¨', 'N', 'Ash', 'CHO', 'NDF_Digest', 'NFC_Digest', 
                           'NDF_ì†Œí™”ìœ¨', 'NFC_ì†Œí™”ìœ¨'];
            const data = prepareDiagramData(formulaDatabase, meChain);
            updateDiagram(data);
            updateActiveButton('showMEChain');
        }

        // DMI ì²´ì¸ë§Œ ë³´ê¸°
        function showDMIChain() {
            const dmiChain = ['DMI', 'ê¸°ë³¸ ì„­ì·¨ëŸ‰', 'ì¡°ì • ê³„ìˆ˜ë“¤', 'ì²´ì¤‘', 'ì˜¨ë„ì¡°ì •', 
                             'ìŠµë„ì¡°ì •', 'ì„ì‹ ì¡°ì •', 'ì˜¨ë„', 'ìŠµë„', 'ì„ì‹ ì¼'];
            const data = prepareDiagramData(formulaDatabase, dmiChain);
            updateDiagram(data);
            updateActiveButton('showDMIChain');
        }

        // ì„ íƒëœ ê²½ë¡œë§Œ ë³´ê¸°
        function showSelectedPath() {
            // í˜„ì¬ ì„ íƒëœ ìˆ˜ì‹ì˜ ê²½ë¡œë§Œ í‘œì‹œ
            const selectedFormula = document.querySelector('.formula-button:focus');
            if (selectedFormula) {
                const formulaName = selectedFormula.textContent;
                const path = getFormulaPath(formulaName);
                const data = prepareDiagramData(formulaDatabase, path);
                updateDiagram(data);
            } else {
                showTopLevel();
            }
            updateActiveButton('showSelectedPath');
        }

        // ìµœìƒìœ„ ìˆ˜ì‹ë§Œ ë³´ê¸° - ì‹¤ì œ ìµœì¢… ê²°ê³¼ê°’ë“¤
        function showTopLevel() {
            // ì‹¤ì œ ìµœì¢… ê²°ê³¼ê°’ë“¤ (ë‹¤ë¥¸ ìˆ˜ì‹ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ìˆ˜ì‹ë“¤)
            const finalResults = Object.values(formulaDatabase)
                .filter(formula => {
                    // ë‹¤ë¥¸ ìˆ˜ì‹ì—ì„œ ì´ ìˆ˜ì‹ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìµœì¢… ê²°ê³¼
                    return !Object.values(formulaDatabase).some(otherFormula => 
                        otherFormula.expression.includes(formula.name)
                    );
                })
                .map(formula => formula.name);
            
            const data = prepareDiagramData(formulaDatabase, finalResults);
            updateDiagram(data);
            updateActiveButton('showTopLevel');
        }

        // ì¤Œ ì´ˆê¸°í™”
        function resetZoom() {
            svg.transition().duration(750).call(
                d3.zoom().transform,
                d3.zoomIdentity
            );
        }

        // ìˆ˜ì‹ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
        function getFormulaPath(formulaName, visited = new Set()) {
            if (visited.has(formulaName)) return [];
            visited.add(formulaName);
            
            const formula = formulaDatabase[formulaName];
            if (!formula) return [formulaName];
            
            const path = [formulaName];
            formula.dependencies.forEach(dep => {
                path.push(...getFormulaPath(dep, visited));
            });
            
            return path;
        }

        // í™œì„± ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateActiveButton(activeFunction) {
            document.querySelectorAll('.control-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeButton = document.querySelector(`[onclick="${activeFunction}()"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }
    </script>
</body>
</html>
